<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="CTF web手、Golang后端开发工程师 研究多线程高并发、渗透测试      Web安全">
    

    <!--Author-->
    
        <meta name="author" content="h3110w0r1d">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="h3110w0r1d&#39;s Blog"/>
    

    <!--Open Graph Description-->
    
        <meta property="og:description" content="CTF web手、Golang后端开发工程师 研究多线程高并发、渗透测试      Web安全" />
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="h3110w0r1d&#39;s Blog"/>

    <!--Type page-->
    
        <meta property="og:type" content="website" />
    

    <!--Page Cover-->
    

    
        <meta name="twitter:card" content="summary" />
    
    
    

    <!-- Title -->
    
    <title>page - h3110w0r1d&#39;s Blog</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/style.css">


    <!-- Google Analytics -->
    


<meta name="generator" content="Hexo 5.4.0"></head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/">
                    Home
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/archives">
                    Archives
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/about.html">
                    About
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/tags">
                    Tags
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/categories">
                    Categories
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/contact.html">
                    Contact
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Hamburger Icon-->
<nav>
    <a href="#menu"></a>
</nav>

<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/"><i class="logo-icon fa fa-cube" aria-hidden="true"></i></a>
        
            <h1 id="main-title" class="title">h3110w0r1d's Blog</h1>
        
    </div>
</header>

        <section class="main">
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/CSRF&SSRF%E6%BC%8F%E6%B4%9E/">
                CSRF&SSRF漏洞
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2023-07-01</span>
            
            
                <a href="http://dezhoutorizhao.github.io/CSRF&SSRF%E6%BC%8F%E6%B4%9E/#disqus_thread" class="comments article-comment-link">留言</a>
            
            
                <span class="category">
                    <a href="/categories/渗透/">渗透</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="CSRF漏洞是什么"><a href="#CSRF漏洞是什么" class="headerlink" title="CSRF漏洞是什么"></a>CSRF漏洞是什么</h1><ol>
<li>  CSRF 全称：Cross-site request forgery，即，跨站请求伪造，也被称为 “One  Click Attack” 或 “Session Riding”，通常缩写为 CSRF 或者 XSRF，是一种对网 站的恶意利用。举个生活中的例子：就是某个人点了个奇怪的链接，自己什么也没输，但 自己的 qq 号或其他的号就被盗了。即该攻击可以在受害者不知情的情况下以受害者名义 伪造请求，执行恶意操作，具有很大的危害性。 </li>
</ol>
<h1 id="CSRF漏洞条件"><a href="#CSRF漏洞条件" class="headerlink" title="CSRF漏洞条件"></a>CSRF漏洞条件</h1><ol>
<li>  目标用户已经登录了网站，有能够执行网站功能的权限</li>
<li>  有构造好的数据包：csrftester工具</li>
<li>  目标用户访问了攻击者构造的URL</li>
</ol>
<h1 id="黑盒测试判断以及修复建议"><a href="#黑盒测试判断以及修复建议" class="headerlink" title="黑盒测试判断以及修复建议"></a>黑盒测试判断以及修复建议</h1><ol>
<li>  判断来源是否相同:数据包的Refer头是请求来源的IP/域名地址的，但是修复不建议，因为可以通过抓包后用burp修改</li>
<li>  看凭据有无token，如果抓包后发现有token就可以放弃使用csrf进行攻击，token是进行前后端验证的，同一个用户，每一次的操作对应的token值是不同的，如果前后端校验token值不同，操作就无法执行</li>
<li>  看关键操作有无验证：安全码、验证码等</li>
</ol>
<h1 id="找内网地址"><a href="#找内网地址" class="headerlink" title="找内网地址"></a>找内网地址</h1><ol>
<li>  从三个网段下手：10.xxx 172.xxx 192.xxx  以上三个是内网的网段</li>
<li>  对最后两段进行爆破</li>
<li>  一般都会开放80端口，就扫某个IP地址的80端口通不通</li>
</ol>
<h1 id="CSRF实例"><a href="#CSRF实例" class="headerlink" title="CSRF实例"></a>CSRF实例</h1><ol>
<li>  本实例采用本人自行开发的项目，未开源</li>
<li>  启动csrftester，并设置监听</li>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20230705165835.png"></li>
<li>  进行注册</li>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20230705165610.png"></li>
<li>  抓到包后generate html，生成对应的html文件，修改对应的input参数</li>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20230705170004.png"></li>
<li>  把改好的html文件上传到外网服务器上，这里我用的apache，就放到/var/www/html路径下即可</li>
<li>  访问（原理应该是被攻击者访问，这里我既作为攻击者，又作为被攻击者）</li>
<li>  有回显，进行跳转，证明攻击成功</li>
<li>  这里test2用户也成功添加，证明攻击成功</li>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20230705171343.png"></li>
</ol>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/CTF%E6%9D%82%E9%A2%98%E9%9B%86%E5%90%88/">
                CTF杂题集合
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2023-06-24</span>
            
            
                <a href="http://dezhoutorizhao.github.io/CTF%E6%9D%82%E9%A2%98%E9%9B%86%E5%90%88/#disqus_thread" class="comments article-comment-link">留言</a>
            
            
                <span class="category">
                    <a href="/categories/CTF/">CTF</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="CTF杂题集合"><a href="#CTF杂题集合" class="headerlink" title="CTF杂题集合"></a>CTF杂题集合</h1><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="签到："><a href="#签到：" class="headerlink" title="签到："></a>签到：</h3><ol>
<li>010editor打开发现PK开头，知道是一个zip压缩包</li>
<li>更改后缀为.zip，解压打开发现flag</li>
</ol>
<h3 id="签到：-1"><a href="#签到：-1" class="headerlink" title="签到："></a>签到：</h3><ol>
<li>BASE85{6:”O=1GX;K8jQKJ;G(“;DhKL9h)S6;BsD:IJ&gt;[;HHmd9h[rJ1c/0%&lt;(g@i6&lt;6QU&lt;\d]P7RpNU:eETA&lt;BWK.4ZtrV}</li>
<li>BASE85解一层出base35</li>
<li><a target="_blank" rel="noopener" href="https://imgtu.com/i/qwIiNQ"><img src="https://s1.ax1x.com/2022/03/27/qwIiNQ.png" alt="qwIiNQ.png"></a></li>
<li>再解一层给出微信id</li>
<li><a target="_blank" rel="noopener" href="https://imgtu.com/i/qwIE3n"><img src="https://s1.ax1x.com/2022/03/27/qwIE3n.png" alt="qwIE3n.png"></a></li>
<li>微信加好友有备注即可获得flag</li>
</ol>
<h3 id="黑化的维亚"><a href="#黑化的维亚" class="headerlink" title="黑化的维亚"></a>黑化的维亚</h3><ol>
<li>用stegsolve打开，查看不同色域下的图片</li>
<li><a target="_blank" rel="noopener" href="https://imgtu.com/i/qwIgDf"><img src="https://s1.ax1x.com/2022/03/27/qwIgDf.png" alt="qwIgDf.png"></a></li>
<li>找到flag的上一级（我一开始还以为这就是flag，提交不对）</li>
<li>后面看到!123和fkvd这么不规则但是又像flag的</li>
<li>后面尝试偏移量为0，1，2，3的栅栏密码，即可解得flag</li>
</ol>
<h3 id="0和1的故事"><a href="#0和1的故事" class="headerlink" title="0和1的故事"></a>0和1的故事</h3><ol>
<li>解压后里面有一个txt文件，打开后看最后发现有==，知道是base64解码</li>
<li><a target="_blank" rel="noopener" href="https://imgtu.com/i/qwb2tO"><img src="https://s1.ax1x.com/2022/03/27/qwb2tO.png" alt="qwb2tO.png"></a></li>
<li>解码网站<a target="_blank" rel="noopener" href="https://the-x.cn/base64/">https://the-x.cn/base64/</a></li>
<li>解码后发现里面有一个png文件，图片中全是01字符</li>
<li><a target="_blank" rel="noopener" href="https://imgtu.com/i/qwbonI"><img src="https://s1.ax1x.com/2022/03/27/qwbonI.png" alt="qwbonI.png"></a></li>
<li>两种选择，一种是利用手机去扫描出文本，第二种是在linux环境下cat出01字符串</li>
<li>得到01字符一开始还以为是一个二进制文件或者是培根密码，然后我五位一解，（解出来的都是什么东西。。。）（培根密码是0为a，1为b，依此得出不同字符）</li>
<li>长和宽相同的情况下猜测是二维码，但是上学期学的py都被时间冲刷干净了，我就在网上找脚本，但是找到的因为MAXN设定的不同，无法得到正确的二维码（轻易改动数据，也会出现数组越界的segementation fault的问题）</li>
<li>后面用excel表格去做，将1所在的单元格填充为黑色，0所在的单元格填充为白色（可能出现的绿色不会影响二维码扫描）</li>
<li><a target="_blank" rel="noopener" href="https://imgtu.com/i/qwbbAf"><img src="https://s1.ax1x.com/2022/03/27/qwbbAf.png" alt="qwbbAf.png"></a></li>
<li>扫描后即可得到flag{Stories_of_0_and_1}</li>
</ol>
<h2 id="web题"><a href="#web题" class="headerlink" title="web题"></a>web题</h2><h3 id="Robot"><a href="#Robot" class="headerlink" title="Robot"></a>Robot</h3><ol>
<li>上来一看什么也没有，就猜测是哪几种题型（反正不可能上来就是sql注入文件上传之类的，没有地方注入东西）</li>
<li>用御剑字典爆破后缀或者用spider去爬，发现有一个txt为后缀的，打开网页得到4ll.html</li>
<li>我一开始还以为是411，结果404就搁置了好久，最后有hint发布，“411和4ll真的能分清吗”，在hackbar中打开，给后缀，excute后给出I have tell you all的字符,还是没有什么东西</li>
<li>ctrl + u查看源代码发现flag</li>
<li>这里由于没有保留截图，也没有环境，暂无截图</li>
</ol>
<h3 id="ezsql"><a href="#ezsql" class="headerlink" title="ezsql"></a>ezsql</h3><ol>
<li>我不知道给的那个hint是什么意思。。。</li>
<li>强大的工具一把梭，我sqlmap跑了好久都没有</li>
<li>这里浅谈一下我的思路吧</li>
<li>两个登录框，分别给出1，1，用burp抓包，发现是post包，post注入</li>
<li><a target="_blank" rel="noopener" href="https://imgtu.com/i/qwLEIf"><img src="https://s1.ax1x.com/2022/03/27/qwLEIf.png" alt="qwLEIf.png"></a></li>
<li><a target="_blank" rel="noopener" href="https://imgtu.com/i/qwLJiT"><img src="https://s1.ax1x.com/2022/03/27/qwLJiT.png" alt="qwLJiT.png"></a></li>
<li>sqlmap post注入的命令分别是：</li>
<li>sqlmap -r “admin.txt” –dbs (–level n)(默认为level 1)</li>
<li>sqlmap -r “admin.txt” -D xxx –tables</li>
<li>sqlmap -r “admin.txt” -D xxx -T xxx –columns</li>
<li>sqlmap -r “admin.txt” -D xxx –T xxx -C xxx –dump</li>
</ol>
<h2 id="密码"><a href="#密码" class="headerlink" title="密码"></a>密码</h2><ol>
<li>猪圈+银河骑士+圣殿+栅栏</li>
<li><a target="_blank" rel="noopener" href="https://imgtu.com/i/qwL7Y8"><img src="https://s1.ax1x.com/2022/03/27/qwL7Y8.png" alt="qwL7Y8.png"></a></li>
</ol>
<h1 id="base64解密"><a href="#base64解密" class="headerlink" title="base64解密"></a>base64解密</h1><pre class="line-numbers language-none"><code class="language-none">来签个到吧！我把奖励放在这里了，手慢无。ZmxhZ3t3ZWxjb21ldG8xMDA4Nn0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol>
<li>因为后面没有明显的==或者=，一开始没想到是base64，就把hex，之类的编码都试了试，试到base64借出flag</li>
<li><img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20220731171328.png"></li>
</ol>
<h1 id="凯撒加密"><a href="#凯撒加密" class="headerlink" title="凯撒加密"></a>凯撒加密</h1><pre class="line-numbers language-none"><code class="language-none">相传有一位大帝叫Caesar，他发明了一种神秘的编码，你能解开这段密文吗？
密文内容：mshn&#123;jhlzhy_pz_mbuufek&#125;。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ol>
<li>题目明显指出是凯撒加密，凯撒加密原理是偏移，1~26之间的字符偏移量</li>
<li>题目前面给的格式很像flag{},m和f之间的字节偏移量为7，即可得到flag<br> <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20220731171636.png"></li>
</ol>
<h2 id="解编码和解古典密码学的网站"><a href="#解编码和解古典密码学的网站" class="headerlink" title="解编码和解古典密码学的网站"></a>解编码和解古典密码学的网站</h2><ol>
<li>cyberchef</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">https:&#x2F;&#x2F;cyberchef.org&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="2">
<li>CTF在线工具</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">http:&#x2F;&#x2F;www.hiencode.com&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h1 id="流量分析"><a href="#流量分析" class="headerlink" title="流量分析"></a>流量分析</h1><ol>
<li>黑客通过webshell往web服务器中写入了一串机密信息，你能找出机密信息吗</li>
<li>webshell后门，我有一个很奇怪的设想，如果不想配置ssh免密登录之类的，可以直接往服务器里丢一个后门，然后蚁剑去连就可以登录了，但是有被杀的风险</li>
<li>题目给了一个pcap文件，导入到wireshark中<br> <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20220731172317.png"></li>
<li>蓝帽杯让我知道，分析流量先分析http</li>
<li>根据题目描述，”webshell”,同时发现了很多上传的shell.php文件，那么就分析分析shell.php<br> <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20220731172458.png"></li>
<li>发现每一个shell.php中都上传一串base64,一个一个解密看看，右键可以复制可打印的字符<br> <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20220731172618.png"></li>
<li>发现有%编码，先解一层URL编码<br> <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20220731172827.png"></li>
<li>再解一层base64，发现是木马，我们走对路了，继续一个一个地找<br> <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20220731174212.png"></li>
<li>最后找着找着flag就出来了<br> <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20220731174348.png"></li>
</ol>
<h1 id="buuctf神奇的二维码"><a href="#buuctf神奇的二维码" class="headerlink" title="buuctf神奇的二维码"></a>buuctf神奇的二维码</h1><ol>
<li>一个二维码，扫一下啥也没有</li>
<li>在放到010editor看头和尾和检查是否为exif隐写之后，binwalk分离出来了压缩包<br> <img src="https://s2.loli.net/2022/05/21/hle1bIpEKm9PzB7.png"></li>
<li>里面有一个encode.txt编码文件<br> <img src="https://s2.loli.net/2022/05/21/VFnBgsLtlZW52J4.png"></li>
<li>解码之后获得密码，打开了放flag的doc文件<br> <img src="https://s2.loli.net/2022/05/21/jz1mJAOsChTuYeL.png"></li>
<li>发现flag.doc文件中是一个特别长的base64编码，使用basecrack破解<br> <img src="https://s2.loli.net/2022/05/21/kmaJoR5WdUAHglS.png"></li>
<li>获得flag<br> <a href="www.strongwill.top/basecrack工具使用">basecrack工具使用</a></li>
</ol>
<h1 id="buu-test-your-nc"><a href="#buu-test-your-nc" class="headerlink" title="buu test_your_nc"></a>buu test_your_nc</h1><p><a href="www.strongwill.top/nc命令">nc命令</a><br><img src="https://s2.loli.net/2022/05/21/8Jj69Obg3DzKQBn.png"></p>
<ol>
<li>直接nc加靶机号，连上之后ls看目录</li>
<li>发现flag，直接cat看一下就报flag</li>
</ol>
<h1 id="pwnthebox-pwnthebox"><a href="#pwnthebox-pwnthebox" class="headerlink" title="pwnthebox pwnthebox"></a>pwnthebox pwnthebox</h1><ol>
<li>信息搜集题目<br> <img src="https://s2.loli.net/2022/05/23/vQ89c6gZWDVSndX.png"></li>
<li>在header中,抓个包<br> <img src="https://s2.loli.net/2022/05/21/qB9zAWvCNQTr6UV.png"></li>
<li>在header中找到了flag</li>
</ol>
<h1 id="pyshell"><a href="#pyshell" class="headerlink" title="pyshell"></a>pyshell</h1><ol>
<li>  python的shell终端</li>
<li>  拼接读取flag的字符串后用eval()进行执行，即可获得flag</li>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20230528145149.png"></li>
</ol>
<h1 id="dumpit"><a href="#dumpit" class="headerlink" title="dumpit"></a>dumpit</h1><ol>
<li><p>对/flag下所有提供的参数进行测试，发现提供的第二个参数可以到日志</p>
<p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20230528145934.png"></p>
<p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20230528150053.png"></p>
</li>
<li><p>  过滤了post和get，不能直接将木马写入参数中执行</p>
</li>
<li><p>  这里采用echo重定向的方式，将待执行的命令写入到User-Agent中，并重定向到/app/log/a.php中</p>
</li>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20230528150351.png"></p>
</li>
<li><p>  访问/log/a.php发现可以成功执行</p>
</li>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20230528150427.png"></p>
</li>
<li><p>  最后在env环境变量中找到flag</p>
</li>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20230528150515.png"></p>
</li>
</ol>
<h1 id="Head-Header"><a href="#Head-Header" class="headerlink" title="Head,Header?"></a>Head,Header?</h1><ol>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20220927190910.png"></li>
<li>  需要CTF浏览器，想到更改UA，UA是服务器识别客户端的操作系统、浏览器等信息的</li>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20220927191126.png"></li>
<li>  有回显，from ctf.com,加referer外链，告诉服务器该页面是从哪个页面链接过来的</li>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20220927191405.png"></li>
<li>  又提示只能local用户查看，修改X-Forwarded-For为127.0.0.1回环地址</li>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20220927191509.png"></li>
</ol>
<h1 id="图片合成问题"><a href="#图片合成问题" class="headerlink" title="图片合成问题"></a>图片合成问题</h1><h2 id="攻防世界what-is-this"><a href="#攻防世界what-is-this" class="headerlink" title="攻防世界what_is_this"></a>攻防世界what_is_this</h2><ol>
<li>给出两张相像的图片</li>
<li>使用stegsolve中的image combiner</li>
<li><a target="_blank" rel="noopener" href="https://imgtu.com/i/qOwZaF"><img src="https://s1.ax1x.com/2022/04/05/qOwZaF.png" alt="qOwZaF.png"></a></li>
<li><a target="_blank" rel="noopener" href="https://imgtu.com/i/qOwe54"><img src="https://s1.ax1x.com/2022/04/05/qOwe54.png" alt="qOwe54.png"></a></li>
<li>其实也可以使用comapre去比较</li>
<li>compare pic1.jpg pic2.jpg -compose src diff.png</li>
</ol>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/ssrf%E6%BC%8F%E6%B4%9E/">
                ssrf漏洞
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2023-04-20</span>
            
            
                <a href="http://dezhoutorizhao.github.io/ssrf%E6%BC%8F%E6%B4%9E/#disqus_thread" class="comments article-comment-link">留言</a>
            
            
                <span class="category">
                    <a href="/categories/CTF/">CTF</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="ssrf漏洞"><a href="#ssrf漏洞" class="headerlink" title="ssrf漏洞"></a>ssrf漏洞</h1><h2 id="自己总结的绕过方法"><a href="#自己总结的绕过方法" class="headerlink" title="自己总结的绕过方法"></a>自己总结的绕过方法</h2><ol>
<li>  进制绕过，127进行<strong>16进制编码</strong>等</li>
<li>  用特殊短地址进行绕过<strong>127.1</strong>或<strong>0.0.0.0</strong>或<strong>0.0</strong>或<strong>0</strong>可以代替127.0.0.1</li>
<li>  正则表达式检验开头结尾的，<strong>用@进行分隔</strong>username和hostname</li>
<li>  302跳转，在自己的服务器上写php Location代码</li>
</ol>
<h2 id="ssrf漏洞是什么"><a href="#ssrf漏洞是什么" class="headerlink" title="ssrf漏洞是什么"></a>ssrf漏洞是什么</h2><ol>
<li><p>  SSRF漏洞（Server-Side Request Forgery）是一种Web应用程序漏洞，它允许攻击者在受攻击的服务器上执行未经授权的网络请求。具体而言，攻击者可以构造一个特制的请求，在请求中指定一个外部的URL地址，然后将该请求发送给目标服务器。目标服务器接收到请求后，会认为这个请求来自于内部网络的可信源，并向指定的URL地址发起请求。由于攻击者可以任意指定这个URL地址，因此可以利用该漏洞实现多种攻击，如获取敏感信息、执行任意命令等。</p>
</li>
<li><p>  SSRF漏洞通常出现在Web应用程序中，例如一个Web应用程序提供了针对用户输入URL的功能，但没有对用户输入的URL做足够的安全检查，导致攻击者可以通过构造恶意URL利用该漏洞。此外，攻击者也可以通过其他途径（如文件上传功能）来利用该漏洞。</p>
</li>
<li><p>  为了防止SSRF漏洞的出现，开发人员需要对Web应用程序中的所有外部请求进行仔细的检查和过滤</p>
</li>
<li><p><img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20230420143621.png"></p>
<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><ol>
<li>  攻击者可以通过公网IP访问到某个web服务器</li>
<li>  攻击者无法通过公网IP访问到内网的其他设备或者办公区域</li>
<li>  这时候如果想要进行内网探测，web服务器同时存在ssrf漏洞，就能够以web服务器作为跳板，进而攻击其它服务器或者区域</li>
</ol>
<h3 id="利用条件"><a href="#利用条件" class="headerlink" title="利用条件"></a>利用条件</h3><p>  （1）web服务器存在SSRF漏洞；</p>
<p>  （2）web服务器有访问本地或远程服务器的权限；</p>
<h3 id="存在位置"><a href="#存在位置" class="headerlink" title="存在位置"></a>存在位置</h3><p>  一般是web服务器提供了从其他服务器获取数据的功能。</p>
<p>  （1）通过URL分享网页内容</p>
<p>  （2）在线翻译</p>
<p>  （3）通过url对图片的加载和下载</p>
<p>  （4）转码服务</p>
<h3 id="利用实验，开启方法"><a href="#利用实验，开启方法" class="headerlink" title="利用实验，开启方法"></a>利用实验，开启方法</h3><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20230420143924.png"></p>
</li>
</ol>
<h3 id="ctfshow351"><a href="#ctfshow351" class="headerlink" title="ctfshow351"></a>ctfshow351</h3><p><img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20230420140824.png"></p>
<p><img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20230420141556.png"></p>
<ol>
<li><p>  源码中接收了一个post传递的url参数，用hackbar去构造攻击payload</p>
</li>
<li><p>```php<br>  url=<a target="_blank" rel="noopener" href="http://127.0.0.1/flag.php">http://127.0.0.1/flag.php</a></p>
  <pre class="line-numbers language-none"><code class="language-none">
3.   即可出现flag

### ctfshow352

### parse_url函数的作用

&#96;parse_url()&#96; 是 PHP 语言中的一个函数，它用于解析 URL 地址并以关联数组的形式返回各个组成部分。在解析过程中，会将 URL 字符串拆分成协议名、主机名、端口号、路径、查询字符串和片段标识等多个组成部分，并分别保存到返回的关联数组中。这个函数不会对 URL 解码，所以可以被用来解析包含特殊字符的 URL。

具体而言，&#96;parse_url()&#96; 函数的格式为：
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>phpCopy Codearray parse_url ( string $url [, int $component = -1 ] )</p>
<pre class="line-numbers language-none"><code class="language-none">
其中，&#96;$url&#96; 参数是要解析的 URL 地址字符串，&#96;$component&#96; 参数可选，表示要返回的 URL 组件，取值范围为 &#96;PHP_URL_SCHEME&#96;、&#96;PHP_URL_HOST&#96;、&#96;PHP_URL_PORT&#96;、&#96;PHP_URL_USER&#96;、&#96;PHP_URL_PASS&#96;、&#96;PHP_URL_PATH&#96;、&#96;PHP_URL_QUERY&#96; 或 &#96;PHP_URL_FRAGMENT&#96;。如果不指定 &#96;$component&#96; 参数，则函数将返回包含所有 URL 组件的关联数组。

例子：
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>phpCopy Code$url = “<a target="_blank" rel="noopener" href="https://www.example.com/test.php?id=123#section4&quot;">https://www.example.com/test.php?id=123#section4&quot;</a>;<br>$parsed_url = parse_url($url);</p>
</li>
</ol>
<p>print_r($parsed_url);</p>
<pre class="line-numbers language-none"><code class="language-none">
输出结果为:
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>Copy CodeArray<br>(<br>    [scheme] =&gt; https<br>    [host] =&gt; <a target="_blank" rel="noopener" href="http://www.example.com/">www.example.com</a><br>    [path] =&gt; /test.php<br>    [query] =&gt; id=123<br>    [fragment] =&gt; section4<br>)</p>
<pre class="line-numbers language-none"><code class="language-none">
### scheme

scheme：协议

### curl

Curl（全称为 &quot;Client Url Library&quot;）是一个被广泛应用于互联网通信的工具和库，它支持各种传输协议，比如FTP、HTTP、SMTP等。在PHP中，curl以扩展库的形式提供，开发者可以借助curl扩展实现各种基于网络协议的操作，例如下载文件、发送HTTP请求、获取API数据等等。

常见的curl函数有:

-   &#96;curl_init()&#96; - 初始化一个 curl 会话
-   &#96;curl_setopt()&#96; - 设置 curl 相关选项
-   &#96;curl_exec()&#96; - 执行 curl 会话
-   &#96;curl_close()&#96; - 关闭curl 会话

&#96;curl_setopt()&#96; 函数可以设置不同的选项来定制 curl 的行为。例如：

-   &#96;CURLOPT_URL&#96; 设置URL地址
-   &#96;CURLOPT_RETURNTRANSFER&#96; 返回结果而不是输出到页面
-   &#96;CURLOPT_POST&#96; 使用POST请求方式
-   &#96;CURLOPT_POSTFIELDS&#96; POST请求提交的数据
-   &#96;CURLOPT_HEADER&#96; 包含响应头信息
-   &#96;CURLOPT_SSL_VERIFYPEER&#96; 是否验证证书等等

以上只是 curl 的一些基本使用方法，通过查阅Curl文档[[1](https:&#x2F;&#x2F;curl.se&#x2F;docs&#x2F;manpage.html)]，你还可以了解到使用curl库还能够支持更多的功能比如: 代理、cookie设置、安全认证、文件上传等。

在 PHP 中，我们可以通过 curl 扩展的一系列函数来实现 curl 功能，并且这些函数具备很高的灵活性和可扩展性，可以根据不同的需求和场景完成各种网络请求操作。

#### 题目

1.   将127.0.1替换为127.0.0，127.1等都可以
2.   之前写过一个golang后端的项目，用的0.0.0.0，既包含了localhost,也包含了127.0.0.1，这里可以绕过字符过滤
3.   ![](https:&#x2F;&#x2F;strongwillpro.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;20230420142950.png)

### web353

1.   可以将127进行16进制编码，编码为0x7f

2.   也可以转换为其它进制

3.   127.0.0.1可以写为127.1也可以绕过

4.   &#96;&#96;&#96;
     url&#x3D;http:&#x2F;&#x2F;0x7f.0.0.1&#x2F;flag.php<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="5">
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20230420144929.png"></li>
</ol>
<h3 id="web335"><a href="#web335" class="headerlink" title="web335"></a>web335</h3><ol>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20230422153422.png"></li>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20230422153448.png"></li>
<li>  用127.1和0.0相同，都可以代替回环地址127.0.0.1</li>
</ol>
<h3 id="web356"><a href="#web356" class="headerlink" title="web356"></a>web356</h3><ol>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20230422153824.png"></li>
<li>  用0也可以代替127.0.0.1或0.0</li>
</ol>
<h3 id="web357"><a href="#web357" class="headerlink" title="web357"></a>web357</h3><ol>
<li><p>  这段代码使用PHP内置函数<code>filter_var()</code>对<code>$ip</code>变量进行IP地址过滤和验证，其中<code>FILTER_VALIDATE_IP</code>用于验证是否为合法的IP地址，<code>FILTER_FLAG_NO_PRIV_RANGE</code>表示拒绝私有IP地址，<code>FILTER_FLAG_NO_RES_RANGE</code>表示拒绝保留IP地址。具体来说，这段代码会返回<code>$ip</code>变量的过滤后结果，如果$ip不是合法的公网IP地址，则返回false。</p>
</li>
<li><p>  这个题利用302跳转</p>
</li>
<li><p>  在服务器上放以下代码</p>
</li>
<li><p>```php</p>
  <?php
  header("Location:http://127.0.0.1/flag.php")
  <pre class="line-numbers language-none"><code class="language-none">
5.   攻击payload

6.   &#96;&#96;&#96;
     url&#x3D;http:&#x2F;&#x2F;www.ctfer.xyz&#x2F;a.php<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>  使用此url参数进行传参，可以通过访问<a target="_blank" rel="noopener" href="http://www.ctfer.xyz下的a.php来跳转访问到内网127.0.0.1下的flag.php文件/">www.ctfer.xyz下的a.php来跳转访问到内网127.0.0.1下的flag.php文件</a></p>
</li>
</ol>
<h3 id="web358"><a href="#web358" class="headerlink" title="web358"></a>web358</h3><ol>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20230427154130.png"></p>
</li>
<li><p>```<br>  /^http://ctf..*show$/i</p>
  <pre class="line-numbers language-none"><code class="language-none">
3.   匹配的是以http:&#x2F;&#x2F;ctf.开头，以show结尾的

4.   &#96;&#96;&#96;url
     http:&#x2F;&#x2F;ctf.@127.0.0.1&#x2F;flag.php?show<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>  使用@作为分隔符，用于指示用户名和域名之间的分界。用于url的基本身份验证，指定用户名和密码来访问资源，例如：<a target="_blank" rel="noopener" href="http://username:password@example.com/">http://username:password@example.com</a></p>
</li>
<li><p>  类似于ssh登录目标主机一样</p>
</li>
<li><p>```<br>  ssh [options] [username@]hostname command<br>  ssh -p 22 <a href="mailto:&#117;&#x73;&#x65;&#114;&#x6e;&#97;&#109;&#x65;&#x40;&#49;&#57;&#x32;&#x2e;&#x31;&#54;&#56;&#46;&#x31;&#x2e;&#x31;&#x30;&#48;">&#117;&#x73;&#x65;&#114;&#x6e;&#97;&#109;&#x65;&#x40;&#49;&#57;&#x32;&#x2e;&#x31;&#54;&#56;&#46;&#x31;&#x2e;&#x31;&#x30;&#48;</a> # 使用22端口连接到主机192.168.1.100<br>  ssh -i ~/.ssh/id_rsa <a href="mailto:&#117;&#x73;&#101;&#114;&#64;&#x65;&#x78;&#x61;&#109;&#112;&#x6c;&#101;&#x2e;&#x63;&#x6f;&#x6d;">&#117;&#x73;&#101;&#114;&#64;&#x65;&#x78;&#x61;&#109;&#112;&#x6c;&#101;&#x2e;&#x63;&#x6f;&#x6d;</a><br>  ssh <a href="mailto:&#x75;&#115;&#x65;&#114;&#x40;&#101;&#x78;&#x61;&#x6d;&#112;&#x6c;&#x65;&#x2e;&#99;&#111;&#x6d;">&#x75;&#115;&#x65;&#114;&#x40;&#101;&#x78;&#x61;&#x6d;&#112;&#x6c;&#x65;&#x2e;&#99;&#111;&#x6d;</a> ls -al /home/user # 登录并执行远程命令</p>
  <pre class="line-numbers language-none"><code class="language-none">
8.   使用@来分隔username和hostname

### web359

1.   工具下载地址https:&#x2F;&#x2F;github.com&#x2F;tarunkant&#x2F;Gopherus

2.   &#96;&#96;&#96;
     python gopherus.py --exploit mysql<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20230427161356.png"></p>
</li>
<li><p>  然后传到check.php中post:returl=xxx，不要忘记把下划线后面的内容url编码一次</p>
</li>
<li><p>  涉及到一些文件上传的知识，最后要用蚁剑去连接</p>
</li>
</ol>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">
                机器学习
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2023-03-03</span>
            
            
                <a href="http://dezhoutorizhao.github.io/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/#disqus_thread" class="comments article-comment-link">留言</a>
            
            
                <span class="category">
                    <a href="/categories/机器学习/">机器学习</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="机器学习"><a href="#机器学习" class="headerlink" title="机器学习"></a>机器学习</h1><h2 id="机器学习就是自动找函数式"><a href="#机器学习就是自动找函数式" class="headerlink" title="机器学习就是自动找函数式"></a>机器学习就是自动找函数式</h2><ol>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20230305145445.png"></li>
<li>  要问自己想要找什么样的函数，先去创建一个任务，regression和classification</li>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20230305145832.png"></li>
<li>  不能只会做判断输出1、2，后面发展到需要generate生成有结构的东西</li>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20230305150144.png"></li>
<li>  怎么告诉机器想要找什么样子的函数：supervised learning,而这需要labeled data，即标注数据集，即告诉机器想要得到的结果是什么样子</li>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20230305150326.png"></li>
<li>  评估一个函数的好坏：函数的LOSS</li>
<li>  下一步，期待机器会自动找出LOSS最低的函数</li>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20230305151035.png"></li>
<li>  机器如何找到你想要的函数：Linear-&gt;Network Architecture：给机器一个函数寻找的范围</li>
</ol>
<h2 id="Supervised-learning-vs-Reinforcement-learning"><a href="#Supervised-learning-vs-Reinforcement-learning" class="headerlink" title="Supervised learning vs Reinforcement learning"></a>Supervised learning vs Reinforcement learning</h2><ol>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20230305151333.png"></li>
<li>  Supervised learning:监督学习，给数据需要标注</li>
<li>  Reinforcement learning:强化学习，给的数据不需要标注</li>
</ol>
<h2 id="Meta-Learning-learn-to-learn-让机器学会学习"><a href="#Meta-Learning-learn-to-learn-让机器学会学习" class="headerlink" title="Meta Learning = learn to learn 让机器学会学习"></a>Meta Learning = learn to learn 让机器学会学习</h2><ol>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20230305193015.png"></li>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20230305193140.png"></li>
</ol>
<h2 id="life-long-learning"><a href="#life-long-learning" class="headerlink" title="life-long-learning"></a>life-long-learning</h2><ol>
<li>  终身学习</li>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20230305193326.png"></li>
</ol>
<h2 id="Regression"><a href="#Regression" class="headerlink" title="Regression"></a>Regression</h2><ol>
<li><p>  找函数</p>
</li>
<li><p><img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20230305194042.png"></p>
<h3 id="三步走"><a href="#三步走" class="headerlink" title="三步走"></a>三步走</h3><ol>
<li>第一步，找一个model</li>
<li><img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20230305194831.png"></li>
<li>第二步，定义function set，在function set中找到一个LOSS值最低的function</li>
<li><img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20230305195047.png"></li>
<li>goodness of function,判断此函数的LOSS值，如何判断：找一个关于此函数的函数，能判断此函数的LOSS值的函数，输入值为a function,输出值为how bad it is,能判断此函数的好坏的值</li>
<li>假设函数是：</li>
<li><img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20230305195659.png"></li>
<li>对此函数的结果求方差（其中^y是求得的估计值，减去的是每一只宝可梦的实际值带入得到的值）</li>
<li><img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20230305195718.png"></li>
<li>第三步，找到最好的function</li>
<li>找一个function，使得找到的L(f)最小，f* = argL(f)</li>
<li>或者找到一个w*,b*，使得argmin L(w,b)最小</li>
<li>第四步，Gradient Descent，目的是找到可以<strong>使LOSS值最小</strong>的w<h3 id="Gradient-Descent"><a href="#Gradient-Descent" class="headerlink" title="Gradient Descent"></a>Gradient Descent</h3><ol>
<li><p>暴力的做法是穷举所有的w,找到LOSS值最小的w</p>
</li>
<li><p>  可以：随机选取初始的w0；构建横轴为w，纵轴为L的坐标系，在初始的w位置L对w的导数（切线斜率），如果切线斜率为负数，则随着w的增大，LOSS值减小，所以要增加w的值；如果斜率为正，则要减小w的值$\frac{dL}{dw}|w=w0$</p>
</li>
<li><p>  增加/减小w的值应该有多大：1. 取决于dL/dw的值（切线斜率、导数）有多大，如果越大，越陡峭，移动距离就越大 2.取决于learning rate的值的大小（事先定好的一个常数），如果learning rate的值较大，踏出一步的时候，参数更新的幅度就比较大，则学习的效率、速度就比较快 </p>
</li>
<li><p>  $w1 = w0 - \eta*\frac{dL}{dw}|w=w0$</p>
</li>
<li><p>  $w2 = w0 - \eta*\frac{dL}{dw}|w=w0$</p>
</li>
<li><p>  经过多次iteration（迭代）之后就到达了local optimal(局部最优解)，此时在local optimal的点，算出的微分都是0了，不会再进行更新</p>
</li>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20230311225527.png"></p>
</li>
<li><p>  当是两个参数时，$w*,b* = arg minL(w,b)$</p>
</li>
<li><p>  思路相同，先选取两个初始值，w0和b0</p>
</li>
<li><p>  然后在初始值位置求偏导$\frac{\partial L}{\partial w}|w=w0,b=b0$,$\frac{\partial L}{\partial b}|w=w0,b=b0$</p>
</li>
<li><p>  更新，$w1 = w0 - \eta*\frac{\partial L}{\partial w}|w=w0,b=b0$,$b1 = b0 - \eta\frac{\partial L}{\partial b}|w=w0,b=b0$</p>
</li>
<li><p>  进行多次iteration(迭代),就可以到达local optimal</p>
</li>
<li><p>  因为Regression是线性的，所以单调，local optimal == global optimal</p>
</li>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20230311230935.png"></p>
</li>
<li><p>  gradient指的是$\frac{\partial L}{\partial w}$,$\frac{\partial L}{\partial b}$所组成的一个vector(向量)，且gradient的符号是倒三角$\nabla$</p>
</li>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20230311231305.png"></p>
</li>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20230311231542.png"></p>
</li>
<li><p>  二维可视化：$(-\eta<em>\frac{\partial L}{\partial b},-\eta</em>\frac{\partial L}{\partial w})$的方向是切线的法线方向，指向的是圆心</p>
</li>
<li><p>  local optimal == global optimal的问题：因为linear regression(线性回归)的loss值是convex（凸面）的，所以没有local optimal(局部最优解)</p>
</li>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20230311232505.png"></p>
</li>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20230311232719.png"></p>
</li>
<li><p>  求复合函数的偏导：外面导里面不导 * 里面导</p>
</li>
</ol>
</li>
</ol>
</li>
</ol>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/docker-k8s%E4%BA%91%E5%8E%9F%E7%94%9F/">
                K8s+Docker+KubeSphere+DevOps
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2022-12-03</span>
            
            
                <a href="http://dezhoutorizhao.github.io/docker-k8s%E4%BA%91%E5%8E%9F%E7%94%9F/#disqus_thread" class="comments article-comment-link">留言</a>
            
            
                <span class="category">
                    <a href="/categories/云原生/">云原生</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="DevOps"><a href="#DevOps" class="headerlink" title="DevOps"></a>DevOps</h1><ol>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221203112901.png"></li>
</ol>
<h2 id="共有云和私有云"><a href="#共有云和私有云" class="headerlink" title="共有云和私有云"></a>共有云和私有云</h2><ol>
<li>  共有云是云服务厂商提供的公有服务器</li>
<li>  私有云是自己买硬件搭建起来的</li>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221203210818.png"></li>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221203211128.png"></li>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221203211151.png"></li>
</ol>
<h2 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h2><ol>
<li><p>  安装nginx</p>
</li>
<li><p>```<br>  apt install nginx</p>
  <pre class="line-numbers language-none"><code class="language-none">
3.   启动nginx

4.   &#96;&#96;&#96;
     systemctl start nginx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>  默认是80端口，所以公网IP:80查看能否访问到nginx</p>
</li>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221203212438.png"></p>
</li>
<li><p>  查看nginx安装地址</p>
</li>
<li><p>```<br>  whereis nginx</p>
  <pre class="line-numbers language-none"><code class="language-none">
9.   ![](https:&#x2F;&#x2F;strongwillpro.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;20221203212535.png)

10.   修改nginx启动页面

11.   ![](https:&#x2F;&#x2F;strongwillpro.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;20221203212603.png)

12.   修改nginx配置，在nginx.conf文件中

13.   ![](https:&#x2F;&#x2F;strongwillpro.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;20221203213426.png)

14.   添加一个server来添加一个公网访问端口

15.   ![](https:&#x2F;&#x2F;strongwillpro.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;20221203213739.png)

16.   &#96;&#96;&#96;
      systemctl restart nginx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>  修改配置文件后需要重启</p>
</li>
</ol>
<h2 id="内网IP"><a href="#内网IP" class="headerlink" title="内网IP"></a>内网IP</h2><ol>
<li>  在同一个集群内部使用内网IP不会消耗流量</li>
<li>  私有IP速度快，没有外网带宽的限制</li>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221203215956.png"></li>
</ol>
<h2 id="VPC、私有网络、专有网络"><a href="#VPC、私有网络、专有网络" class="headerlink" title="VPC、私有网络、专有网络"></a>VPC、私有网络、专有网络</h2><ol>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221203220253.png"></li>
<li>  后面的/16叫做掩码部分，说明前16位保持不变，后16位变化</li>
<li>  所以VPC的作用就是划分网段</li>
<li>  如果采用16位掩码，可以从192.168.0.0-192.168.255.255总共容纳255*255一共65536台机器</li>
<li>  但是其中的192.168.0.0和192.168.0.255不能用，所以掐头去尾一共能用的只有254个</li>
<li>  选择创建交换机</li>
<li>  开发人员和生产人员在不同的专有网络下，增加了一定的安全性</li>
</ol>
<h2 id="docker"><a href="#docker" class="headerlink" title="docker"></a>docker</h2><p><a target="_blank" rel="noopener" href="https://www.yuque.com/leifengyang/oncloud/mbvigg">Docker基本概念 (yuque.com)</a></p>
<ol>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221204171236.png"></li>
<li>  容器化技术</li>
<li>  现有虚拟化技术的缺点：VMware或virtualbox等</li>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221204171338.png"></li>
<li>  docker虚拟化技术</li>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221204171601.png"></li>
</ol>
<h3 id="docker的架构"><a href="#docker的架构" class="headerlink" title="docker的架构"></a>docker的架构</h3><ol>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221204173401.png"></li>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221204173531.png"></li>
<li>  <a target="_blank" rel="noopener" href="https://www.yuque.com/leifengyang/oncloud/mbvigg#2ASxH">Docker基本概念 (yuque.com)</a></li>
</ol>
<h2 id="Jenkins"><a href="#Jenkins" class="headerlink" title="Jenkins"></a>Jenkins</h2><h3 id="负责将开发人员的代码发送到运维人员进行部署"><a href="#负责将开发人员的代码发送到运维人员进行部署" class="headerlink" title="负责将开发人员的代码发送到运维人员进行部署"></a>负责将开发人员的代码发送到运维人员进行部署</h3><ol>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221210175818.png"></li>
<li></li>
</ol>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/hive%E6%95%B0%E6%8D%AE%E5%AE%9A%E4%B9%89%E8%AF%AD%E8%A8%80DDL/">
                hive数据定义语言DDL
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2022-11-14</span>
            
            
                <a href="http://dezhoutorizhao.github.io/hive%E6%95%B0%E6%8D%AE%E5%AE%9A%E4%B9%89%E8%AF%AD%E8%A8%80DDL/#disqus_thread" class="comments article-comment-link">留言</a>
            
            
                <span class="category">
                    <a href="/categories/hive/">hive</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="hive数-据定义语言DDL"><a href="#hive数-据定义语言DDL" class="headerlink" title="hive数 据定义语言DDL"></a>hive数 据定义语言DDL</h1><h2 id="数据定义语言概述"><a href="#数据定义语言概述" class="headerlink" title="数据定义语言概述"></a>数据定义语言概述</h2><ol>
<li>  数据定义语言 (Data Definition Language, DDL)，是SQL语言集中对数据库内部的对象结构进行创建，删除，修改等的操作语言，这些数据库对象包括database（schema）、table、view、index等。</li>
<li>  DDL核心语法由CREATE、ALTER与DROP三个所组成。DDL是对表结构进行的操作。</li>
<li>  在某些上下文中，该术语也称为数据描述语言，因为它描述了数据库表中的字段和记录。</li>
</ol>
<h2 id="Hive-DDL操作"><a href="#Hive-DDL操作" class="headerlink" title="Hive DDL操作"></a>Hive DDL操作</h2><h3 id="DDL基本概念"><a href="#DDL基本概念" class="headerlink" title="DDL基本概念"></a>DDL基本概念</h3><ol>
<li>  在Hive中，DATABASE的概念和RDBMS中类似，我们称之为数据库，DATABASE和SCHEMA是可互换的，都可以使用。</li>
<li>  hive的数据库本质上就是一个目录</li>
<li>  默认的数据库叫做default,存储于/user/hive/warehouse下</li>
<li>  用户自己创建的数据库存储位置是/user/hive/warehouse/数据库名.db下</li>
</ol>
<h3 id="数据库的基本命令"><a href="#数据库的基本命令" class="headerlink" title="数据库的基本命令"></a>数据库的基本命令</h3><ol>
<li><p>  show databases 查看系统中所有的数据库</p>
</li>
<li><p>```<br>  show databases;</p>
  <pre class="line-numbers language-none"><code class="language-none">
3.   ![](https:&#x2F;&#x2F;strongwillpro.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;20221114193204.png)

4.   create table 创建数据库

5.   &#96;&#96;&#96;hive
     create (DATABASE|SCHEMA) [IF NOT EXISTS] database_name
     [COMMENT database_comment] -- COMMENT用来添加数据库的注释说明语句
     [LOCATION hdfs_path] -- LOCATION用来指定数据库在HDFS的存储位置，默认&#x2F;user&#x2F;hive&#x2F;warehouse&#x2F;dbname.db
     [WITH DBPROPERTIES (proterty_name &#x3D; property_value,...)];<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>  如果需要使用location指定路径的时候，最好指向的是一个新创建的空文件夹</p>
</li>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221114194309.png"></p>
</li>
<li><p>  describe database 查看数据库结构</p>
</li>
<li><p>  显示hive中数据库的名称，注释（如果已经设置），及其在文件系统中的位置等信息</p>
</li>
<li><p>  extended关键字用于显示更多的信息，可以将describe简写成desc来使用</p>
</li>
<li><p>```hive<br>  describe database/schema extended db_name;<br>  desc database [extend] db_name;</p>
  <pre class="line-numbers language-none"><code class="language-none">
12.   ![](https:&#x2F;&#x2F;strongwillpro.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;20221114200306.png)

13.   ![](https:&#x2F;&#x2F;strongwillpro.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;20221114200312.png)

14.   use database;选择当前的数据库

15.   &#96;&#96;&#96;hive
      use database db_name;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>  alter database 修改数据库的内容</p>
</li>
<li><p>  更改与Hive中的数据库相关联的元数据</p>
</li>
<li><p>```hive<br>  alter (database|schema) database_name set dbproperties (property_name=property_value,…); – 更改数据库的属性</p>
  <pre class="line-numbers language-none"><code class="language-none">
19.   &#96;&#96;&#96;hive
      alter (database|schema) database_name set OWNER USER user; -- 更改数据库的所有者<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
<li><p>```hive<br>  alter (database|schema) database_name set location hdfs_path; – 更改数据库的位置</p>
  <pre class="line-numbers language-none"><code class="language-none">
21.   ![](https:&#x2F;&#x2F;strongwillpro.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;20221114201434.png)

22.   ![](https:&#x2F;&#x2F;strongwillpro.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;20221114201439.png)

23.   drop database 删除数据库

24.   默认行为是RESTRICT,意味着仅在数据库为空时才删除它

25.   要删除带有表的数据库（不为空的数据库），我们可以使用CASCADE

26.   &#96;&#96;&#96;hive
      DROP (DATABASE|SCHEMA) [IF EXISTS] database_name [RESTRICT|CASCADE];<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221114204811.png"></p>
</li>
</ol>
<h3 id="Hive表的基本命令"><a href="#Hive表的基本命令" class="headerlink" title="Hive表的基本命令"></a>Hive表的基本命令</h3><ol>
<li><p>  show tables;查看hive表的列表</p>
</li>
<li><p>```hive<br>  show tables in 数据库名;</p>
  <pre class="line-numbers language-none"><code class="language-none">
3.   ![](https:&#x2F;&#x2F;strongwillpro.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;20221114205024.png)

4.   创建表的语法树

5.   &#96;&#96;&#96;hive
      CREATE [TEMPORARY] [EXTERNAL] TABLE [IF NOT EXISTS] [db_name.]table_name  
      [(col_name data_type [COMMENT col_comment], ... ]  
      [COMMENT table_comment]  
      [PARTITIONED BY (col_name data_type [COMMENT col_comment], ...)]  
      [CLUSTERED BY (col_name, col_name, ...) [SORTED BY (col_name [ASC|DESC], ...)] INTO num_buckets BUCKETS]  
      [ROW FORMAT DELIMITED|SERDE serde_name WITH SERDEPROPERTIES (property_name&#x3D;property_value,...)]  
      [STORED AS file_format]  
      [LOCATION hdfs_path]  
      [TBLPROPERTIES (property_name&#x3D;property_value, ...)];
     -- 建表语法中的语法顺序需要和语法树中的一致<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>  建表语法中的语法顺序需要和语法树中的一致</p>
</li>
</ol>
<h2 id="Hive数据类型"><a href="#Hive数据类型" class="headerlink" title="Hive数据类型"></a>Hive数据类型</h2><ol>
<li><p>  数据类型指的是表中列的字段类型</p>
</li>
<li><p>  分为：原生数据类型和复杂数据类型</p>
</li>
<li><p>  原生数据类型包括：数值类型、时间日期类型、字符串类型、杂项数据类型；</p>
</li>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221114210333.png"></p>
</li>
<li><p>  复杂数据类型包括：array数组、map映射、struct结构、union联合体。</p>
</li>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221114210350.png"></p>
</li>
<li><p>  因为底层是用Java写的，所以支持Java的数据类型，比如字符串string</p>
</li>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221114210535.png"></p>
</li>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221114210636.png"></p>
</li>
<li><p>  显示类型转换使用CAST函数</p>
</li>
<li><p>```hive<br>  CAST(‘100’ as INT) – 会将字符串100转换为100整数值<br>  – 如果强制类型转换失败，函数会返回NULL</p>
  <pre class="line-numbers language-none"><code class="language-none">
12.   ![](https:&#x2F;&#x2F;strongwillpro.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;20221114211004.png)

13.   ![](https:&#x2F;&#x2F;strongwillpro.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;20221114211011.png)

### 默认分隔符

1.   Hive建表时如果没有row format语法指定分隔符，则采用默认分隔符，是用来分隔字段的，默认的分割符是‘\001&#39;，是一种特殊的字符，使用的是ASCII编码的值，键盘是打不出来的。
2.   ![](https:&#x2F;&#x2F;strongwillpro.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;20221114211310.png)
3.   在vim编辑器中，连续按下Ctrl+v&#x2F;Ctrl+a即可输入&#39;\001&#39; ，显示^A
4.   ![](https:&#x2F;&#x2F;strongwillpro.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;20221114211526.png)
5.   在一些文本编辑器中将以SOH的形式显示：
6.   ![](https:&#x2F;&#x2F;strongwillpro.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;20221114211637.png)

## Hive数据存储路径

1.   将数据放在表目录下，即可映射数据到Hive表中

2.   &#96;&#96;&#96;hive
     hadoop fs -put stuent2.txt &#x2F;user&#x2F;hive&#x2F;warehouse&#x2F;mydb1.db&#x2F;student2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>  在Hive建表的时候，可以<strong>通过location语法</strong>来<strong>更改数据在HDFS上的存储路径</strong>，使得建表加载数据更加灵活方便。</p>
</li>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221114212524.png"></p>
</li>
</ol>
<h2 id="查看Hive表的结构"><a href="#查看Hive表的结构" class="headerlink" title="查看Hive表的结构"></a>查看Hive表的结构</h2><ol>
<li><p>  describe 表名</p>
</li>
<li><p>  显示Hive中表的元数据信息，如果指定了EXTENDED关键字，则它将以Thrift序列化形式显示表的所有元数据；如果指定了FORMATTED关键字，则它将以表格格式显示元数据。</p>
</li>
<li><p>  取表中指定的数据创建一个新表，使用AS指定SQL查询语句，查询语句的结果即为新表的结构和内容</p>
</li>
<li><p>```hive<br>  create table if not exists student5 as select id,name from student1 where age &gt;= 20;</p>
  <pre class="line-numbers language-none"><code class="language-none">
## LIKE创建表

1.   使用LIKE创建一张表结构与某个表相同的新表，新表中内容为空。

2.   &#96;&#96;&#96;hive
     create table if not exists student6 like student1;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>  类似于拷贝一张表的结构</p>
</li>
</ol>
<h2 id="元数据和主数据的区别"><a href="#元数据和主数据的区别" class="headerlink" title="元数据和主数据的区别"></a>元数据和主数据的区别</h2><ol>
<li>  <strong>元数据</strong>：即<strong>关于数据的数据</strong>，用以描述数据及其环境的结构化信息，便于查找、理解、使用和管理数据。</li>
<li>  <strong>主数据</strong>：主数据则定义企业核心业务对象，如客户、产品、地址等，与交易流水信息不同，主数据一旦被记录到数据库中，需要经常对其进行维护，从而确保其时效性和准确性；主数据还包括关系数据，用以描述主数据之间的关系，如客户与产品的关系、产品与地域的关系、客户与客户的关系、产品与产品的关系等。</li>
</ol>
<h2 id="Hive的内部表和外部表"><a href="#Hive的内部表和外部表" class="headerlink" title="Hive的内部表和外部表"></a>Hive的内部表和外部表</h2><ol>
<li><p>  <strong>内部表也被称为被Hive拥有和管理的托管表</strong></p>
</li>
<li><p>  默认情况下创建的表就是内部表，Hive拥有该表的结构和文件。换句话说，Hive完全管理表（元数据和数据）的生命周期，类似于RDBMS中的表。</p>
</li>
<li><p>  当删除内部表时，会删除数据以及表的元数据（元数据指的是数据的属性信息，而不是具体的数据）</p>
</li>
<li><p>  可以使用DESCRIBE FORMATTED table_name 来获取表的元数据信息，从中可以看出表的类型</p>
</li>
<li><p>```hive<br>  DESCRIBE FORMATTED table_name;</p>
  <pre class="line-numbers language-none"><code class="language-none">
6.   ![](https:&#x2F;&#x2F;strongwillpro.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;20221114220742.png)

7.   外部表：外部表中的数据不是Hive拥有或管理的，只管理表元数据的生命周期

8.   要创建一个外部表，需要使用EXTERNAL关键字

9.   删除外部表只会删除元数据，而不会删除实际数据，在Hive外部仍然可以访问实际数据

### 内外部表的相同和不同之处

1.   都会在Hive **Metastore中管理**表的定义、字段类型等**元数据信息**
2.   删除**内部表**时，除了会从Metastore中删除表元数据，还**会从HDFS中删除其所有数据文件**。
3.   删除**外部表**时，只会从Metastore中删除表的元数据，并**保持HDFS位置中的实际数据不变**。

## DDL表的修改和删除

1.   ![](https:&#x2F;&#x2F;strongwillpro.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;20221114222014.png)

2.   drop语句可以指定垃圾桶

3.   &#96;&#96;&#96;hive
     drop table [if exists] table_name [PURGE];<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221114222116.png"></p>
</li>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221114222252.png"></p>
</li>
</ol>
<h2 id="普通表数据加载"><a href="#普通表数据加载" class="headerlink" title="普通表数据加载"></a>普通表数据加载</h2><h3 id="加载本地数据"><a href="#加载本地数据" class="headerlink" title="加载本地数据"></a>加载本地数据</h3><ol>
<li><p>  创建一张普通表</p>
</li>
<li><p>```hive<br>  create table t_student(<br>  num int,<br>  name string,<br>  sex string,<br>  age int,<br>  dept string)<br>  row format delimited fields terminated by ‘,’;<br>  – delimited fields的意思是分隔字段，delimited指分隔的<br>  – fields 字段<br>  – terminated by 终止于<br>  – 行格式分隔符，采用行格式进行分隔</p>
  <pre class="line-numbers language-none"><code class="language-none">
3.   将本地数据加载进这张普通表中

4.   &#96;&#96;&#96;hive
     load data local inpath 本地文件及路径 [overwrite] into table 表明;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221114191539.png"></p>
</li>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221114191546.png"></p>
</li>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221114191558.png"></p>
</li>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221114191604.png"></p>
</li>
</ol>
<h3 id="加载HDFS中的数据"><a href="#加载HDFS中的数据" class="headerlink" title="加载HDFS中的数据"></a>加载HDFS中的数据</h3><ol>
<li><p>```hive<br>  load data inpath ‘/hivedata/student.txt’ overwrite into table t_student;<br>  – 没有local参数即为从HDFS中取数据并加载</p>
  <pre class="line-numbers language-none"><code class="language-none">
2.   ![](https:&#x2F;&#x2F;strongwillpro.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;20221114191829.png)

3.   ![](https:&#x2F;&#x2F;strongwillpro.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;20221114191833.png)

### 插入数据 insert + select (需要执行MR程序)

1.   &#96;&#96;&#96;hive
     insert into table table_name select xxx from othertablename;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221114192009.png"></p>
</li>
</ol>
<h2 id="分区表"><a href="#分区表" class="headerlink" title="分区表"></a>分区表</h2><h3 id="分区表的产生原因"><a href="#分区表的产生原因" class="headerlink" title="分区表的产生原因"></a>分区表的产生原因</h3><ol>
<li>  where语句的背后需要进行全表扫描才能过滤出结果，对于hive来说需要扫描每一个文件。如果数据文件个数特别多的话，扫描效率很慢也没必要。</li>
<li>  如果只需求需要一个archer.txt文件，只需要扫描archer.txt文件即可，如何优化可以加快查询，减少全表扫描呢？</li>
<li>  指定文件扫描和全表扫描，效率还是存在差异的。</li>
<li>  分区表的创建目的就是为了减少扫描文件的大小，减少全表扫描的概率，提高效率</li>
<li>  当Hive表对应的数据量大、文件个数多时，<strong>为了避免查询时全表扫描数据</strong>，Hive<strong>支持根据指定的字段对表进行分区</strong>，分区的字段可以是日期、地域、种类等具有标识意义的字段。</li>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221115163907.png"></li>
</ol>
<h2 id="分区表的创建和数据加载"><a href="#分区表的创建和数据加载" class="headerlink" title="分区表的创建和数据加载"></a>分区表的创建和数据加载</h2><ol>
<li><p>  <strong>分区字段不能与表中已经存在的字段同名</strong>，分区字段可以<strong>以虚拟字段的形式</strong>显示在表结构的最后</p>
</li>
<li><p>```hive<br>  –分区表建表语法<br>  CREATE TABLE table_name (<br>  column1 data_type, <br>  column2 data_type,<br>  ….) <br>  PARTITIONED BY (partition1 data_type, partition2 data_type,…);</p>
  <pre class="line-numbers language-none"><code class="language-none">
3.   &#96;&#96;&#96;hive
     create table t_all_hero_part(
     id int,
     name string,
     hp_max int,
     mp_max int,
     attack_max int,
     defense_max int,
     attack_range string,
     role_assist string
     ) partitioned by (role_main string) -- 这里是分区字段
     row format delimited
     fields terminated by &quot;\t&quot;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221115164953.png"></p>
</li>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221115165209.png"></p>
</li>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221115165921.png"></p>
</li>
<li><p>```hive<br>  load data local inpath ‘/root/hivedata/archer.txt’ into table t_all_hero_part partition(role_main=’sheshou’);<br>  load data local inpath ‘/root/hivedata/assassin.txt’ into table t_all_hero_part partition(role _main =’cike’);load data local inpath ‘/root/hivedata/mage.txt’ into table t_all_hero_part partition(role _main =’fashi’);</p>
  <pre class="line-numbers language-none"><code class="language-none">
8.   我的理解是：实际字段可以不包含**源数据**中的所有列，但是**实际字段+虚拟字段（partition字段）要能对应源数据中的每一个列**

9.   ![](https:&#x2F;&#x2F;strongwillpro.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;20221115173138.png)

10.   ![](https:&#x2F;&#x2F;strongwillpro.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;20221115173304.png)

11.   ![](https:&#x2F;&#x2F;strongwillpro.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;20221115173248.png)

### 分区表和普通表的区别

1.   外表上看起来分区表好像没多大变化，实际上**分区表在底层管理数据的方式发生了改变**。
2.   普通表
3.   ![](https:&#x2F;&#x2F;strongwillpro.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;20221115190253.png)
4.   分区表
5.   ![](https:&#x2F;&#x2F;strongwillpro.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;20221115190301.png)
6.   分区的概念提供了一种**将Hive表数据分离为多个文件&#x2F;目录的方法**。
7.   **不同分区对应着不同的文件夹**，同一分区的数据存储在同一个文件夹下
8.   这种指定分区查询的方式叫做**分区裁剪**。

### 分区表的重点在于

1.   建表时根据业务场景**设置合适的分区字段**。比如日期、地域、类别等

2.   查询的时候尽量**先使用where进行分区过滤**，查询**指定分区的数据**，**避免全表扫描**

3.   &#96;&#96;&#96;hive
     select count(*) from t_all_hero where role_main&#x3D;&#39;archer&#39; and hp_max &gt; 5800;
     select count(*) from t_all_hero where role_main&#x3D;&#39;sheshou&#39; and hp_max &gt; 5800;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>  分区字段不能和表中已有的字段同名</p>
</li>
<li><p>  分区字段是虚拟字段，其数据并不存储在底层的文件中</p>
</li>
<li><p>  分区字段值的确定来自于<strong>用户价值数据手动指定</strong>（静态分区）或者根据<strong>查询结果位置自动推断</strong>（动态分区）</p>
</li>
<li><p>  Hive<strong>支持多重分区</strong>，也就是说在分区的基础上继续分区，划分更加细粒度</p>
</li>
</ol>
<h3 id="分区表的数据加载"><a href="#分区表的数据加载" class="headerlink" title="分区表的数据加载"></a>分区表的数据加载</h3><h4 id="动态分区插入"><a href="#动态分区插入" class="headerlink" title="动态分区插入"></a>动态分区插入</h4><ol>
<li><p>  所谓<strong>动态分区指的是分区的字段值是基于查询结果（参数位置）自动推断出来的</strong>。</p>
</li>
<li><p>  核心语法就是insert+select</p>
</li>
<li><p>```hive<br>  insert into table table_name PARTITION(分区字段) SELECT *** FROM othertable_name;</p>
  <pre class="line-numbers language-none"><code class="language-none">
4.   启动动态分区需要开启动态分区功能，在hive会话中设置几个参数

5.   &#96;&#96;&#96;hive
     set hive.exec.dynamic.partition&#x3D;true; -- 是否开启动态分区功能
     set hive.exec.dynamic.partition.mode&#x3D;nonstrict; -- 指定动态分区模式，分为nonstrick非严格模式和strict严格模式 , strict严格模式要求至少有一个分区为静态分区
     set hive.exec.max.dynamic.partitions&#x3D;50000;
     set hive.exec.max.dynamic.partitions.pernode&#x3D;10000;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>```hive<br>  – 创建一张表<br>  create table t_usa_covid19(<br>  count_date string,<br>  county string,<br>  state string,<br>  fips int,<br>  cases int,<br>  deaths int)<br>  row format delimited<br>  fields terminated by ‘,’;</p>
  <pre class="line-numbers language-none"><code class="language-none">
7.   &#96;&#96;&#96;bash
     -- 将所有的数据都加载进去
     hadoop fs -put us-covid19-countries.dat &#x2F;user&#x2F;hive&#x2F;warehouse&#x2F;mydb2.db&#x2F;t_usa_covid19;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221115193714.png"></p>
</li>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221115193953.png"></p>
</li>
<li><p>  多重分区表</p>
</li>
<li><p>```hive<br>  partitioned by (partition1 data_type,partition2,data_type,…)</p>
  <pre class="line-numbers language-none"><code class="language-none">
12.   多重分区下，分区之间是一种递进关系，可以理解为**在前一个分区的基础上继续分区**。从HDFS的角度来看就是**文件夹下继续划分子文件夹**。

13.   ![](https:&#x2F;&#x2F;strongwillpro.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;20221115194448.png)

14.   &#96;&#96;&#96;hive
      --单分区表，按省份分区
      create table t_user_province (id int, name string,age int) partitioned by (province string);
      --双分区表，按省份和市分区
      create table t_user_province_city (id int, name string,age int) partitioned by (province string, city string);
      --三分区表，按省份、市、县分区
      create table t_user_province_city_county (id int, name string,age int) partitioned by (province string, city string,county string);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<h3 id="对于分区表的DDL操作"><a href="#对于分区表的DDL操作" class="headerlink" title="对于分区表的DDL操作"></a>对于分区表的DDL操作</h3><ol>
<li><p>  主要包括：增加分区，删除分区，修改分区</p>
</li>
<li><p>  增加分区：</p>
</li>
<li><p>```hive<br>  alter table 表名 add partition (分区字段)<br>  location ‘分区字段需要的数据文件所在的HDFS位置’</p>
  <pre class="line-numbers language-none"><code class="language-none">
## 分桶表

1.   分桶表对应的数据文件**在底层会被分解为若干个部分**，通俗来说就是**被拆分成若干个独立的小文件**。

2.   在分桶时，要指定根据哪个字段将数据分为几桶（几个部分）。

3.   ![](https:&#x2F;&#x2F;strongwillpro.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;20221115203849.png)

4.   &#96;&#96;&#96;hive
     create [external] table [db_name.]table_name
     [(col_name data_type,...)]
     clustered by(col_name) -- clustered by 根据哪个字段进行分
     into N buckets; -- 分成几桶<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/virtualbox%E5%AF%BC%E5%85%A5hadoop%E9%9B%86%E7%BE%A4/">
                virtual导入hadoop集群
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2022-11-08</span>
            
            
                <a href="http://dezhoutorizhao.github.io/virtualbox%E5%AF%BC%E5%85%A5hadoop%E9%9B%86%E7%BE%A4/#disqus_thread" class="comments article-comment-link">留言</a>
            
            
                <span class="category">
                    <a href="/categories/hadoop/">hadoop</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="virtualbox导入Hadoop集群"><a href="#virtualbox导入Hadoop集群" class="headerlink" title="virtualbox导入Hadoop集群"></a>virtualbox导入Hadoop集群</h1><ol>
<li>  导出虚拟电脑，导出默认为.ova格式</li>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221108222022.png"></li>
<li>  选择要导出的虚拟机</li>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221108222046.png"></li>
<li>  导入虚拟电脑，选择路径，直接指向第一步导出的.ova格式文件</li>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221108221530.png"></li>
<li>  启动hadoop集群和启动hive都没有问题</li>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221114111909.png"></li>
</ol>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/go%E7%88%AC%E8%99%AB%E9%A1%B9%E7%9B%AE/">
                go爬虫项目
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2022-11-04</span>
            
            
                <a href="http://dezhoutorizhao.github.io/go%E7%88%AC%E8%99%AB%E9%A1%B9%E7%9B%AE/#disqus_thread" class="comments article-comment-link">留言</a>
            
            
                <span class="category">
                    <a href="/categories/go/">go</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="go爬虫项目"><a href="#go爬虫项目" class="headerlink" title="go爬虫项目"></a>go爬虫项目</h1><h2 id="爬虫步骤"><a href="#爬虫步骤" class="headerlink" title="爬虫步骤"></a>爬虫步骤</h2><ol>
<li>  明确目标(确定在哪个网站搜索)</li>
<li>  爬（爬下内容）</li>
<li>  取（筛选想要的内容）</li>
<li>  处理数据（按照你的想法进行处理）</li>
</ol>
<h2 id="发送请求"><a href="#发送请求" class="headerlink" title="发送请求"></a>发送请求</h2><ol>
<li><p>  构造客户端</p>
</li>
<li><p><img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221105110355.png"></p>
  <pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">var</span> client http<span class="token punctuation">.</span>Client
<span class="token comment">//Client类型代表HTTP客户端。它的零值（DefaultClient）是一个可用的使用DefaultTransport的客户端。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
<li><p>构造get请求</p>
  <pre class="line-numbers language-go" data-language="go"><code class="language-go">reqList<span class="token punctuation">,</span> err <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">NewRequest</span><span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span> URL<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
<span class="token comment">//返回值是Request包和一个错误类型的值，Request中包含了请求头，请求体（get请求没有请求体），host值等信息</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
<li><p>添加请求头,为了防止浏览器检测到爬虫访问，添加一些请求头来伪造成浏览器访问</p>
  <pre class="line-numbers language-go" data-language="go"><code class="language-go">req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Connection"</span><span class="token punctuation">,</span> <span class="token string">"keep-alive"</span><span class="token punctuation">)</span>
req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Pragma"</span><span class="token punctuation">,</span> <span class="token string">"no-cache"</span><span class="token punctuation">)</span>
req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Cache-Control"</span><span class="token punctuation">,</span> <span class="token string">"no-cache"</span><span class="token punctuation">)</span>
req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Upgrade-Insecure-Requests"</span><span class="token punctuation">,</span> <span class="token string">"1"</span><span class="token punctuation">)</span>
req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">,</span> <span class="token string">"application/x-www-form-urlencoded"</span><span class="token punctuation">)</span>
req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"User-Agent"</span><span class="token punctuation">,</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.198 Safari/537.36"</span><span class="token punctuation">)</span>
req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Accept"</span><span class="token punctuation">,</span> <span class="token string">"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9"</span><span class="token punctuation">)</span>
req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Accept-Language"</span><span class="token punctuation">,</span> <span class="token string">"zh-CN,zh;q=0.9"</span><span class="token punctuation">)</span>
        <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>发送请求</p>
  <pre class="line-numbers language-go" data-language="go"><code class="language-go">resp<span class="token punctuation">,</span>err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span> <span class="token comment">//client的Do方法，将接收一个request类型的参数，发送request请求，返回http回复，第一个参数接收，接收的参数自动为Response类型</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"请求失败"</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">defer</span> resp<span class="token punctuation">.</span>Body<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//程序在使用完回复后必须关闭回复的主体，defer关键字类似于其它语言的析构函数，释放对应内存，Close()函数关闭</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221105162556.png"></p>
</li>
</ol>
<h2 id="解析网页"><a href="#解析网页" class="headerlink" title="解析网页"></a>解析网页</h2><pre class="line-numbers language-go" data-language="go"><code class="language-go">docDetail <span class="token punctuation">,</span>err <span class="token operator">:=</span> goquery<span class="token punctuation">.</span><span class="token function">NewDocumentFromReader</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>Body<span class="token punctuation">)</span>
<span class="token comment">//NewDocumentFromReader函数将从response的body内返回一个文档，解析为html并返回给第一个参数，如果不能解析为html，则返回错误作为第二个值</span>
<span class="token comment">//docDetail接收的是解析后的html文件</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"解析失败"</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221105162225.png"></li>
</ol>
<h2 id="获取节点信息"><a href="#获取节点信息" class="headerlink" title="获取节点信息"></a>获取节点信息</h2><ol>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221105163708.png"></p>
</li>
<li><p>  github.com/PuerkitoBio/goquery包内内置了Find函数，”Find 获取当前匹配元素集中每个元素的后代，由选择器过滤。,它返回一个包含这些匹配元素的新选择对象。”</p>
</li>
<li><p>  内置了Each函数，“每个迭代一个 Selection 对象，为每个匹配的元素执行一个函数。<strong>它返回当前的 Selection 对象。</strong>函数 f 为选择中的每个元素调用，该选择中元素的索引从 0 开始，*Selection 仅包含该元素”</p>
</li>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221105164020.png"></p>
</li>
<li><p>```go<br>  docDetail.Find(“#content &gt; div &gt; div.article &gt; ol &gt; li &gt; div”). //列表,使用Document.Find创建初始选择，然后用类似jQuery的可链接语法和方法进行操作</p>
<pre><code>      Each(func(i int,s * goquery.Selection)&#123; //在列表里面继续找，第一个参数代表的是索引
          title := s.Find(&quot;div.info &gt; div.hd &gt; a &gt; span:nth-child(1)&quot;).Text()
          img := s.Find(&quot;div.pic &gt; a &gt; img&quot;) //img标签 -&gt; src属性里面
          imgTmp , ok := img.Attr(&quot;src&quot;)
          info := s.Find(&quot;div.info &gt; div.bd &gt; p:nth-child(1)&quot;).Text()
          score := s.Find(&quot;div.info &gt; div.bd &gt; div &gt; span.rating_num&quot;).Text()
          quote := s.Find(&quot;div.info &gt; div.bd &gt; p.quote &gt; span&quot;).Text()
          if ok &#123;
              fmt.Println(&quot;title&quot;,title)
              fmt.Println(&quot;imgTmp&quot;,imgTmp)
              fmt.Println(&quot;info&quot;,info)
              fmt.Println(&quot;score&quot;,score)
              fmt.Println(&quot;quote&quot;,quote)
          &#125;
      &#125;) 
</code></pre>
  <pre class="line-numbers language-none"><code class="language-none">
## 利用正则去区分不同内容

1.   &#96;&#96;&#96;go
     func infoSpite(info string) (director string,actor string,year string) &#123;
     	&#x2F;&#x2F;directory
     	directoryRe , _ :&#x3D; regexp.Compile(&#96;导演:(.*)主演:&#96;)
     	director &#x3D; string(directoryRe.Find([]byte(info)))
     
     	&#x2F;&#x2F;actor
     	actorRe , _ :&#x3D; regexp.Compile(&#96;主演:(.*)&#96;)
     	actor &#x3D; string(actorRe.Find([]byte(info)))
     
     	&#x2F;&#x2F;year
     	yearRe,_ :&#x3D; regexp.Compile(&#96;(\d+)&#96;)
     	year &#x3D; string(yearRe.Find([]byte(info)))
     	return
     &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<h3 id="定义结构体去存储不同的信息"><a href="#定义结构体去存储不同的信息" class="headerlink" title="定义结构体去存储不同的信息"></a>定义结构体去存储不同的信息</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">//结构体的定义</span>
<span class="token keyword">type</span> MovieData <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
	Title <span class="token builtin">string</span>
	Director <span class="token builtin">string</span>
	Picture <span class="token builtin">string</span>
	Actor <span class="token builtin">string</span>
	Year <span class="token builtin">string</span>
	Score <span class="token builtin">string</span>
	Quote <span class="token builtin">string</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">//给不同的变量传参</span>
<span class="token keyword">if</span> ok <span class="token punctuation">&#123;</span>
	director<span class="token punctuation">,</span>actor<span class="token punctuation">,</span>year <span class="token operator">:=</span> <span class="token function">infoSpite</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span>
	data<span class="token punctuation">.</span>Title<span class="token operator">=</span>title
	data<span class="token punctuation">.</span>Director<span class="token operator">=</span>director
	data<span class="token punctuation">.</span>Picture<span class="token operator">=</span>imgTmp
	data<span class="token punctuation">.</span>Actor<span class="token operator">=</span>actor
	data<span class="token punctuation">.</span>Year<span class="token operator">=</span>year
	data<span class="token punctuation">.</span>Score<span class="token operator">=</span>score
	data<span class="token punctuation">.</span>Quote<span class="token operator">=</span>quote
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"data%v\n"</span><span class="token punctuation">,</span>data<span class="token punctuation">)</span> <span class="token comment">//打印一下检测是否正确存储</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="修改参数"><a href="#修改参数" class="headerlink" title="修改参数"></a>修改参数</h3><ol>
<li><p>  每一页的传参是通过get传参，给start变量传参</p>
</li>
<li><p>```go<br>  req,err := http.NewRequest(“GET”,”<a target="_blank" rel="noopener" href="https://movie.douban.com/top250?start=&quot;+page,nil">https://movie.douban.com/top250?start=&quot;+page,nil</a>)</p>
  <pre class="line-numbers language-none"><code class="language-none">
## 链接数据库

&#96;&#96;&#96;go
&#x2F;&#x2F;数据库初始化
func InitDB() &#123;
	&#x2F;&#x2F;链接数据库
	DB , err :&#x3D; sql.Open(&quot;mysql&quot;,USERNAME + &quot;:&quot; + PASSWORD + &quot;@tcp(&quot; + HOST + &quot;)&#x2F;&quot; + DBNAME)
	if err !&#x3D; nil &#123;
		panic(err.Error())
	&#125;
	DB.SetConnMaxLifetime(10)
	DB.SetMaxIdleConns(5)
	if err :&#x3D; DB.Ping() ; err !&#x3D; nil &#123;
		fmt.Println(&quot;open database fail&quot;)
		return
	&#125;
	fmt.Println(&quot;connect success&quot;)
&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>  连接数据库用来保存爬下来的数据</p>
</li>
</ol>
<h2 id="将爬下来的数据插入到数据库中，定义插入函数"><a href="#将爬下来的数据插入到数据库中，定义插入函数" class="headerlink" title="将爬下来的数据插入到数据库中，定义插入函数"></a>将爬下来的数据插入到数据库中，定义插入函数</h2><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">//插入数据</span>
<span class="token keyword">func</span> <span class="token function">InsertData</span><span class="token punctuation">(</span>moviedata MovieData<span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">&#123;</span>
	<span class="token comment">//新建事务</span>
	tx <span class="token punctuation">,</span> err <span class="token operator">:=</span> DB<span class="token punctuation">.</span><span class="token function">Begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"begin err"</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span>
	<span class="token punctuation">&#125;</span>
	stmt <span class="token punctuation">,</span> err <span class="token operator">:=</span> tx<span class="token punctuation">.</span><span class="token function">Prepare</span><span class="token punctuation">(</span><span class="token string">"INSERT INTO movie_data(Title,Director,Picture,Actor,Year,Score,Quote) VALUES(?,?,?,?,?,?,?)"</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"prepare fail err"</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span>
	<span class="token punctuation">&#125;</span>
	<span class="token boolean">_</span> <span class="token punctuation">,</span> err <span class="token operator">=</span>stmt<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span>moviedata<span class="token punctuation">.</span>Title<span class="token punctuation">,</span>moviedata<span class="token punctuation">.</span>Director<span class="token punctuation">,</span>moviedata<span class="token punctuation">.</span>Picture<span class="token punctuation">,</span>moviedata<span class="token punctuation">.</span>Actor<span class="token punctuation">,</span>moviedata<span class="token punctuation">.</span>Year<span class="token punctuation">,</span>moviedata<span class="token punctuation">.</span>Score<span class="token punctuation">,</span>moviedata<span class="token punctuation">.</span>Quote<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"exec fail"</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	<span class="token boolean">_</span> <span class="token operator">=</span> tx<span class="token punctuation">.</span><span class="token function">Commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token boolean">true</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="综上，没有实现高并发的代码"><a href="#综上，没有实现高并发的代码" class="headerlink" title="综上，没有实现高并发的代码"></a>综上，没有实现高并发的代码</h2><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"database/sql"</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"net/http"</span>
	<span class="token string">"regexp"</span>
	<span class="token string">"strconv"</span>
	<span class="token boolean">_</span> <span class="token string">"github.com/go-sql-driver/mysql"</span>
	<span class="token string">"github.com/PuerkitoBio/goquery"</span>
<span class="token punctuation">)</span>

<span class="token comment">//数据库配置</span>
<span class="token keyword">const</span> <span class="token punctuation">(</span>
	USERNAME <span class="token operator">=</span> <span class="token string">"root"</span>
	PASSWORD <span class="token operator">=</span> <span class="token string">"20030729a"</span>
	HOST <span class="token operator">=</span> <span class="token string">"127.0.0.1"</span>
	PORT <span class="token operator">=</span> <span class="token string">"3306"</span>
	DBNAME <span class="token operator">=</span> <span class="token string">"movie"</span>
<span class="token punctuation">)</span>

<span class="token keyword">var</span> DB <span class="token operator">*</span>sql<span class="token punctuation">.</span>DB

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token function">InitDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> i<span class="token operator">:=</span><span class="token number">0</span> <span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">&#123;</span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"正在爬取第%v页信息\n"</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span>
		<span class="token function">Spider</span><span class="token punctuation">(</span>strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">type</span> MovieData <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
	Title <span class="token builtin">string</span>
	Director <span class="token builtin">string</span>
	Picture <span class="token builtin">string</span>
	Actor <span class="token builtin">string</span>
	Year <span class="token builtin">string</span>
	Score <span class="token builtin">string</span>
	Quote <span class="token builtin">string</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token function">Spider</span><span class="token punctuation">(</span>page <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token comment">//1. 发送请求</span>
	<span class="token keyword">var</span> client http<span class="token punctuation">.</span>Client
	<span class="token keyword">var</span> data MovieData
	req<span class="token punctuation">,</span>err <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">NewRequest</span><span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span><span class="token string">"https://movie.douban.com/top250?start="</span><span class="token operator">+</span>page<span class="token punctuation">,</span><span class="token boolean">nil</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"req.err"</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	<span class="token comment">//防止浏览器检爬虫访问，所以加一些请求头伪造成浏览器访问</span>
	req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Connection"</span><span class="token punctuation">,</span> <span class="token string">"keep-alive"</span><span class="token punctuation">)</span>
	req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Pragma"</span><span class="token punctuation">,</span> <span class="token string">"no-cache"</span><span class="token punctuation">)</span>
	req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Cache-Control"</span><span class="token punctuation">,</span> <span class="token string">"no-cache"</span><span class="token punctuation">)</span>
	req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Upgrade-Insecure-Requests"</span><span class="token punctuation">,</span> <span class="token string">"1"</span><span class="token punctuation">)</span>
	req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">,</span> <span class="token string">"application/x-www-form-urlencoded"</span><span class="token punctuation">)</span>
	req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"User-Agent"</span><span class="token punctuation">,</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.198 Safari/537.36"</span><span class="token punctuation">)</span>
	req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Accept"</span><span class="token punctuation">,</span> <span class="token string">"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9"</span><span class="token punctuation">)</span>
	req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Accept-Language"</span><span class="token punctuation">,</span> <span class="token string">"zh-CN,zh;q=0.9"</span><span class="token punctuation">)</span>

	resp<span class="token punctuation">,</span>err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"请求失败"</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">defer</span> resp<span class="token punctuation">.</span>Body<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">//2. 解析网页</span>
	docDetail <span class="token punctuation">,</span>err <span class="token operator">:=</span> goquery<span class="token punctuation">.</span><span class="token function">NewDocumentFromReader</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>Body<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"解析失败"</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	<span class="token comment">//3. 获取节点信息,copy css selector</span>
	<span class="token comment">//.grid_view > li:nth-child(1) > div:nth-child(1) > div:nth-child(2) > div:nth-child(1) > a:nth-child(1)</span>
	<span class="token comment">//#content > div > div.article > ol > li:nth-child(1) > div > div.info > div.hd > a > span:nth-child(1)</span>
	<span class="token comment">//.grid_view > li:nth-child(1) > div:nth-child(1) > div:nth-child(2) > div:nth-child(1) > a:nth-child(1)</span>
	<span class="token comment">//.grid_view > li:nth-child(3)</span>
	<span class="token comment">//.grid_view > li:nth-child(4)</span>
	docDetail<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token string">"#content > div > div.article > ol > li > div"</span><span class="token punctuation">)</span><span class="token punctuation">.</span> <span class="token comment">//列表</span>
		<span class="token function">Each</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>i <span class="token builtin">int</span><span class="token punctuation">,</span>s <span class="token operator">*</span> goquery<span class="token punctuation">.</span>Selection<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token comment">//在列表里面继续找</span>
			title <span class="token operator">:=</span> s<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token string">"div.info > div.hd > a > span:nth-child(1)"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			img <span class="token operator">:=</span> s<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token string">"div.pic > a > img"</span><span class="token punctuation">)</span> <span class="token comment">//img标签 -》 src属性里面</span>
			imgTmp <span class="token punctuation">,</span> ok <span class="token operator">:=</span> img<span class="token punctuation">.</span><span class="token function">Attr</span><span class="token punctuation">(</span><span class="token string">"src"</span><span class="token punctuation">)</span>
			info <span class="token operator">:=</span> s<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token string">"div.info > div.bd > p:nth-child(1)"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			score <span class="token operator">:=</span> s<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token string">"div.info > div.bd > div > span.rating_num"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			quote <span class="token operator">:=</span> s<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token string">"div.info > div.bd > p.quote > span"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token comment">//4. 保存信息</span>
			<span class="token keyword">if</span> ok <span class="token punctuation">&#123;</span>
				director<span class="token punctuation">,</span>actor<span class="token punctuation">,</span>year <span class="token operator">:=</span> <span class="token function">infoSpite</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span>
				data<span class="token punctuation">.</span>Title<span class="token operator">=</span>title
				data<span class="token punctuation">.</span>Director<span class="token operator">=</span>director
				data<span class="token punctuation">.</span>Picture<span class="token operator">=</span>imgTmp
				data<span class="token punctuation">.</span>Actor<span class="token operator">=</span>actor
				data<span class="token punctuation">.</span>Year<span class="token operator">=</span>year
				data<span class="token punctuation">.</span>Score<span class="token operator">=</span>score
				data<span class="token punctuation">.</span>Quote<span class="token operator">=</span>quote
				<span class="token keyword">if</span> <span class="token function">InsertData</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
					fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"插入成功"</span><span class="token punctuation">)</span>
				<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
					fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"插入失败"</span><span class="token punctuation">)</span>
					<span class="token keyword">return</span>
				<span class="token punctuation">&#125;</span>
				<span class="token comment">// fmt.Println("data%v\n",data)</span>
			<span class="token punctuation">&#125;</span>
		<span class="token punctuation">&#125;</span><span class="token punctuation">)</span> 
			<span class="token keyword">return</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token function">infoSpite</span><span class="token punctuation">(</span>info <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>director <span class="token builtin">string</span><span class="token punctuation">,</span>actor <span class="token builtin">string</span><span class="token punctuation">,</span>year <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token comment">//directory</span>
	directoryRe <span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> regexp<span class="token punctuation">.</span><span class="token function">Compile</span><span class="token punctuation">(</span><span class="token string">`导演:(.*)主演:`</span><span class="token punctuation">)</span>
	director <span class="token operator">=</span> <span class="token function">string</span><span class="token punctuation">(</span>directoryRe<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

	<span class="token comment">//actor</span>
	actorRe <span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> regexp<span class="token punctuation">.</span><span class="token function">Compile</span><span class="token punctuation">(</span><span class="token string">`主演:(.*)`</span><span class="token punctuation">)</span>
	actor <span class="token operator">=</span> <span class="token function">string</span><span class="token punctuation">(</span>actorRe<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

	<span class="token comment">//year</span>
	yearRe<span class="token punctuation">,</span><span class="token boolean">_</span> <span class="token operator">:=</span> regexp<span class="token punctuation">.</span><span class="token function">Compile</span><span class="token punctuation">(</span><span class="token string">`(\d+)`</span><span class="token punctuation">)</span>
	year <span class="token operator">=</span> <span class="token function">string</span><span class="token punctuation">(</span>yearRe<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">//数据库初始化</span>
<span class="token keyword">func</span> <span class="token function">InitDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token comment">//链接数据库</span>
	DB <span class="token punctuation">,</span> err <span class="token operator">:=</span> sql<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">"mysql"</span><span class="token punctuation">,</span><span class="token string">"root:20030729a@tcp(localhost:3306)/movie"</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	DB<span class="token punctuation">.</span><span class="token function">SetConnMaxLifetime</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
	DB<span class="token punctuation">.</span><span class="token function">SetMaxIdleConns</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">:=</span> DB<span class="token punctuation">.</span><span class="token function">Ping</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"open database fail"</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">&#125;</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"connect success"</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>


<span class="token comment">//插入数据</span>
<span class="token keyword">func</span> <span class="token function">InsertData</span><span class="token punctuation">(</span>moviedata MovieData<span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">&#123;</span>
	<span class="token comment">//新建事务</span>
	tx <span class="token punctuation">,</span> err <span class="token operator">:=</span> DB<span class="token punctuation">.</span><span class="token function">Begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"begin err"</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span>
	<span class="token punctuation">&#125;</span>
	stmt <span class="token punctuation">,</span> err <span class="token operator">:=</span> tx<span class="token punctuation">.</span><span class="token function">Prepare</span><span class="token punctuation">(</span><span class="token string">"INSERT INTO movie_data(Title,Director,Picture,Actor,Year,Score,Quote) VALUES(?,?,?,?,?,?,?)"</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"prepare fail err"</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span>
	<span class="token punctuation">&#125;</span>
	<span class="token boolean">_</span> <span class="token punctuation">,</span> err <span class="token operator">=</span>stmt<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span>moviedata<span class="token punctuation">.</span>Title<span class="token punctuation">,</span>moviedata<span class="token punctuation">.</span>Director<span class="token punctuation">,</span>moviedata<span class="token punctuation">.</span>Picture<span class="token punctuation">,</span>moviedata<span class="token punctuation">.</span>Actor<span class="token punctuation">,</span>moviedata<span class="token punctuation">.</span>Year<span class="token punctuation">,</span>moviedata<span class="token punctuation">.</span>Score<span class="token punctuation">,</span>moviedata<span class="token punctuation">.</span>Quote<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"exec fail"</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	<span class="token boolean">_</span> <span class="token operator">=</span> tx<span class="token punctuation">.</span><span class="token function">Commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token boolean">true</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="实现结果"><a href="#实现结果" class="headerlink" title="实现结果"></a>实现结果</h2><ol>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221106104406.png"></li>
</ol>
<h2 id="出现问题及解决方法"><a href="#出现问题及解决方法" class="headerlink" title="出现问题及解决方法"></a>出现问题及解决方法</h2><h3 id="too-many-connection"><a href="#too-many-connection" class="headerlink" title="too many connection"></a>too many connection</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go">tx<span class="token punctuation">,</span> err <span class="token operator">:=</span> DB<span class="token punctuation">.</span><span class="token function">Begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"tx fail"</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span>
	<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol>
<li><p>  当启动数据库时报错：too many connection ，1040错误</p>
</li>
<li><p>  默认情况下，同时处理100个链接</p>
</li>
<li><p>  但是，由于爬虫爬取速度太高，无法同时处理多个链接，会报错1040</p>
</li>
<li><p>此时可以调高mysql的最大链接数量</p>
  <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">set</span> <span class="token keyword">global</span> max_connections <span class="token operator">=</span> 合适的链接数量<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
<h3 id="爬取内容超出了数据类型所能容纳的"><a href="#爬取内容超出了数据类型所能容纳的" class="headerlink" title="爬取内容超出了数据类型所能容纳的"></a>爬取内容超出了数据类型所能容纳的</h3><ol>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221106104918.png"></li>
<li>  当爬取内容的长度超出了数据类型所能容纳的，可以调高varchar的最高容纳长度</li>
</ol>
<h2 id="高并发爬虫"><a href="#高并发爬虫" class="headerlink" title="高并发爬虫"></a>高并发爬虫</h2><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"database/sql"</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"github.com/PuerkitoBio/goquery"</span>
	<span class="token boolean">_</span> <span class="token string">"github.com/jinzhu/gorm/dialects/mysql"</span>
	<span class="token string">"log"</span>
	<span class="token string">"net/http"</span>
	<span class="token string">"regexp"</span>
	<span class="token string">"strconv"</span>
	<span class="token string">"strings"</span>
	<span class="token string">"time"</span>
<span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token punctuation">(</span>
	USERNAME <span class="token operator">=</span> <span class="token string">"root"</span>
	PASSWORD <span class="token operator">=</span> <span class="token string">"root"</span>
	HOST <span class="token operator">=</span> <span class="token string">"127.0.0.1"</span>
	PORT <span class="token operator">=</span> <span class="token string">"3306"</span>
	DBNAME <span class="token operator">=</span> <span class="token string">"douban_movie"</span>
<span class="token punctuation">)</span>

<span class="token keyword">var</span> DB <span class="token operator">*</span>sql<span class="token punctuation">.</span>DB


<span class="token keyword">type</span> MovieData <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
	Title    <span class="token builtin">string</span> <span class="token string">`json:"title"`</span>
	Director <span class="token builtin">string</span> <span class="token string">`json:"director"`</span>
	Picture  <span class="token builtin">string</span> <span class="token string">`json:"picture"`</span>
	Actor    <span class="token builtin">string</span> <span class="token string">`json:"actor"`</span>
	Year     <span class="token builtin">string</span> <span class="token string">`json:"year"`</span>
	Score    <span class="token builtin">string</span> <span class="token string">`json:"score"`</span>
	Quote    <span class="token builtin">string</span> <span class="token string">`json:"quote"`</span>
<span class="token punctuation">&#125;</span>


<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token function">InitDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	start <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">//for i := 0; i &lt; 10; i++ &#123;</span>
	<span class="token comment">//	Spider(strconv.Itoa(i*25))</span>
	<span class="token comment">//&#125;</span>
	ch <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">bool</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">go</span> <span class="token function">Spider</span><span class="token punctuation">(</span>strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ch<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">&#123;</span>
		<span class="token operator">&lt;-</span>ch
	<span class="token punctuation">&#125;</span>
	elapsed <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"ChannelStart Time %s \n"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>elapsed<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token function">Spider</span><span class="token punctuation">(</span>page <span class="token builtin">string</span><span class="token punctuation">,</span>ch <span class="token keyword">chan</span> <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	client <span class="token operator">:=</span> <span class="token operator">&amp;</span>http<span class="token punctuation">.</span>Client<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
	req<span class="token punctuation">,</span> err <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">NewRequest</span><span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"https://movie.douban.com/top250?start="</span><span class="token operator">+</span>page<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Connection"</span><span class="token punctuation">,</span> <span class="token string">"keep-alive"</span><span class="token punctuation">)</span>
	req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Cache-Control"</span><span class="token punctuation">,</span> <span class="token string">"max-age=0"</span><span class="token punctuation">)</span>
	req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"sec-ch-ua-mobile"</span><span class="token punctuation">,</span> <span class="token string">"?0"</span><span class="token punctuation">)</span>
	req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Upgrade-Insecure-Requests"</span><span class="token punctuation">,</span> <span class="token string">"1"</span><span class="token punctuation">)</span>
	req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"User-Agent"</span><span class="token punctuation">,</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.110 Safari/537.36"</span><span class="token punctuation">)</span>
	req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Accept"</span><span class="token punctuation">,</span> <span class="token string">"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9"</span><span class="token punctuation">)</span>
	req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Sec-Fetch-Site"</span><span class="token punctuation">,</span> <span class="token string">"same-origin"</span><span class="token punctuation">)</span>
	req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Sec-Fetch-Mode"</span><span class="token punctuation">,</span> <span class="token string">"navigate"</span><span class="token punctuation">)</span>
	req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Sec-Fetch-User"</span><span class="token punctuation">,</span> <span class="token string">"?1"</span><span class="token punctuation">)</span>
	req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Sec-Fetch-Dest"</span><span class="token punctuation">,</span> <span class="token string">"document"</span><span class="token punctuation">)</span>
	req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Referer"</span><span class="token punctuation">,</span> <span class="token string">"https://movie.douban.com/chart"</span><span class="token punctuation">)</span>
	req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Accept-Language"</span><span class="token punctuation">,</span> <span class="token string">"zh-CN,zh;q=0.9"</span><span class="token punctuation">)</span>
	resp<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">defer</span> resp<span class="token punctuation">.</span>Body<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	docDetail<span class="token punctuation">,</span> err <span class="token operator">:=</span> goquery<span class="token punctuation">.</span><span class="token function">NewDocumentFromReader</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>Body<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	docDetail<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token string">"#content > div > div.article > ol > li > div"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Each</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>i <span class="token builtin">int</span><span class="token punctuation">,</span> s <span class="token operator">*</span>goquery<span class="token punctuation">.</span>Selection<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			<span class="token keyword">var</span> movieData MovieData
			<span class="token comment">//#content > div > div.article > ol > li:nth-child(16) > div > div.info > div.hd > a > span:nth-child(1)</span>
			title <span class="token operator">:=</span> s<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token string">"div.info > div.hd > a > span:nth-child(1)"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			img <span class="token operator">:=</span> s<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token string">"div.pic > a > img"</span><span class="token punctuation">)</span>
			imgTmp<span class="token punctuation">,</span> ok <span class="token operator">:=</span> img<span class="token punctuation">.</span><span class="token function">Attr</span><span class="token punctuation">(</span><span class="token string">"src"</span><span class="token punctuation">)</span>
			info <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token string">"div.info > div.bd > p:nth-child(1)"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">)</span>
			director<span class="token punctuation">,</span> actor<span class="token punctuation">,</span> year <span class="token operator">:=</span> <span class="token function">InfoSpite</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span>
			score <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token string">"div.info > div.bd > div > span.rating_num"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">)</span>
			score <span class="token operator">=</span> strings<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span>score<span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">)</span>
			quote <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token string">"div.info > div.bd > p.quote > span"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">)</span>
			<span class="token keyword">if</span> ok <span class="token punctuation">&#123;</span>
				movieData<span class="token punctuation">.</span>Title <span class="token operator">=</span> title
				movieData<span class="token punctuation">.</span>Director <span class="token operator">=</span> director
				movieData<span class="token punctuation">.</span>Picture <span class="token operator">=</span> imgTmp
				movieData<span class="token punctuation">.</span>Actor <span class="token operator">=</span> actor
				movieData<span class="token punctuation">.</span>Year <span class="token operator">=</span> year
				movieData<span class="token punctuation">.</span>Score <span class="token operator">=</span> score
				movieData<span class="token punctuation">.</span>Quote <span class="token operator">=</span> quote
				fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>movieData<span class="token punctuation">)</span>
				<span class="token function">InsertSql</span><span class="token punctuation">(</span>movieData<span class="token punctuation">)</span>
			<span class="token punctuation">&#125;</span>
		<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> ch <span class="token operator">!=</span> <span class="token boolean">nil</span><span class="token punctuation">&#123;</span>
		ch <span class="token operator">&lt;-</span> <span class="token boolean">true</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token function">InfoSpite</span><span class="token punctuation">(</span>info <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>director <span class="token punctuation">,</span>actor <span class="token punctuation">,</span> year <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	directorRe<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> regexp<span class="token punctuation">.</span><span class="token function">Compile</span><span class="token punctuation">(</span><span class="token string">`导演:(.*)主演:`</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>director<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">8</span> <span class="token punctuation">&#123;</span>
		director <span class="token operator">=</span> <span class="token function">string</span><span class="token punctuation">(</span>directorRe<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
		director <span class="token operator">=</span> <span class="token function">string</span><span class="token punctuation">(</span>directorRe<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
	<span class="token punctuation">&#125;</span>
	director <span class="token operator">=</span> strings<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span>director<span class="token punctuation">,</span> <span class="token string">"主演:"</span><span class="token punctuation">)</span>
	actorRe<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> regexp<span class="token punctuation">.</span><span class="token function">Compile</span><span class="token punctuation">(</span><span class="token string">`主演:(.*)`</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>actor<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">8</span> <span class="token punctuation">&#123;</span>
		actor <span class="token operator">=</span> <span class="token function">string</span><span class="token punctuation">(</span>actorRe<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
		actor <span class="token operator">=</span> <span class="token function">string</span><span class="token punctuation">(</span>actorRe<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
	<span class="token punctuation">&#125;</span>
	yearRe<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> regexp<span class="token punctuation">.</span><span class="token function">Compile</span><span class="token punctuation">(</span><span class="token string">`(\d+)`</span><span class="token punctuation">)</span>
	year <span class="token operator">=</span> <span class="token function">string</span><span class="token punctuation">(</span>yearRe<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token function">InitDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
	DB<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> sql<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">"mysql"</span><span class="token punctuation">,</span> <span class="token string">"root:20030729a@tcp(localhost:3306)/movie"</span><span class="token punctuation">)</span>
	DB<span class="token punctuation">.</span><span class="token function">SetConnMaxLifetime</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
	DB<span class="token punctuation">.</span><span class="token function">SetMaxIdleConns</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">:=</span> DB<span class="token punctuation">.</span><span class="token function">Ping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span><span class="token punctuation">&#123;</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"opon database fail"</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">&#125;</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"connnect success"</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token function">InsertSql</span><span class="token punctuation">(</span>movieData MovieData<span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">&#123;</span>
	tx<span class="token punctuation">,</span> err <span class="token operator">:=</span> DB<span class="token punctuation">.</span><span class="token function">Begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"tx fail"</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span>
	<span class="token punctuation">&#125;</span>
	stmt<span class="token punctuation">,</span> err <span class="token operator">:=</span> tx<span class="token punctuation">.</span><span class="token function">Prepare</span><span class="token punctuation">(</span><span class="token string">"INSERT INTO movie_data (`Title`,`Director`,`Actor`,`Year`,`Score`,`Quote`) VALUES (?, ?, ?,?,?,?)"</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Prepare fail"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span>
	<span class="token punctuation">&#125;</span>
	<span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">=</span> stmt<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span>movieData<span class="token punctuation">.</span>Title<span class="token punctuation">,</span> movieData<span class="token punctuation">.</span>Director<span class="token punctuation">,</span> movieData<span class="token punctuation">.</span>Actor<span class="token punctuation">,</span> movieData<span class="token punctuation">.</span>Year<span class="token punctuation">,</span> movieData<span class="token punctuation">.</span>Score<span class="token punctuation">,</span> movieData<span class="token punctuation">.</span>Quote<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Exec fail"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span>
	<span class="token punctuation">&#125;</span>
	<span class="token boolean">_</span> <span class="token operator">=</span> tx<span class="token punctuation">.</span><span class="token function">Commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token boolean">true</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221106110604.png"></p>
</li>
<li><p>高并发爬虫爬取同等内容需要1s左右</p>
  <pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"database/sql"</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"github.com/PuerkitoBio/goquery"</span>
	<span class="token boolean">_</span> <span class="token string">"github.com/jinzhu/gorm/dialects/mysql"</span>
	<span class="token string">"log"</span>
	<span class="token string">"net/http"</span>
	<span class="token string">"regexp"</span>
	<span class="token string">"strconv"</span>
	<span class="token string">"strings"</span>
	<span class="token string">"time"</span>
<span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token punctuation">(</span>
	USERNAME <span class="token operator">=</span> <span class="token string">"root"</span>
	PASSWORD <span class="token operator">=</span> <span class="token string">"root"</span>
	HOST <span class="token operator">=</span> <span class="token string">"127.0.0.1"</span>
	PORT <span class="token operator">=</span> <span class="token string">"3306"</span>
	DBNAME <span class="token operator">=</span> <span class="token string">"douban_movie"</span>
<span class="token punctuation">)</span>

<span class="token keyword">var</span> DB <span class="token operator">*</span>sql<span class="token punctuation">.</span>DB


<span class="token keyword">type</span> MovieData <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
	Title    <span class="token builtin">string</span> <span class="token string">`json:"title"`</span>
	Director <span class="token builtin">string</span> <span class="token string">`json:"director"`</span>
	Picture  <span class="token builtin">string</span> <span class="token string">`json:"picture"`</span>
	Actor    <span class="token builtin">string</span> <span class="token string">`json:"actor"`</span>
	Year     <span class="token builtin">string</span> <span class="token string">`json:"year"`</span>
	Score    <span class="token builtin">string</span> <span class="token string">`json:"score"`</span>
	Quote    <span class="token builtin">string</span> <span class="token string">`json:"quote"`</span>
<span class="token punctuation">&#125;</span>


<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token function">InitDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	start <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">&#123;</span>
		<span class="token function">Spider</span><span class="token punctuation">(</span>strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	<span class="token comment">// ch := make(chan bool)</span>
	<span class="token comment">// for i := 0; i &lt; 10; i++ &#123;</span>
	<span class="token comment">// 	Spider(strconv.Itoa(i*25), ch)</span>
	<span class="token comment">// &#125;</span>
	<span class="token comment">// for i := 0; i &lt; 10; i++ &#123;</span>
	<span class="token comment">// 	&lt;-ch</span>
	<span class="token comment">// &#125;</span>
	elapsed <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"ChannelStart Time %s \n"</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>elapsed<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token function">Spider</span><span class="token punctuation">(</span>page <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	client <span class="token operator">:=</span> <span class="token operator">&amp;</span>http<span class="token punctuation">.</span>Client<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
	req<span class="token punctuation">,</span> err <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">NewRequest</span><span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"https://movie.douban.com/top250?start="</span><span class="token operator">+</span>page<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Connection"</span><span class="token punctuation">,</span> <span class="token string">"keep-alive"</span><span class="token punctuation">)</span>
	req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Cache-Control"</span><span class="token punctuation">,</span> <span class="token string">"max-age=0"</span><span class="token punctuation">)</span>
	req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"sec-ch-ua-mobile"</span><span class="token punctuation">,</span> <span class="token string">"?0"</span><span class="token punctuation">)</span>
	req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Upgrade-Insecure-Requests"</span><span class="token punctuation">,</span> <span class="token string">"1"</span><span class="token punctuation">)</span>
	req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"User-Agent"</span><span class="token punctuation">,</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.110 Safari/537.36"</span><span class="token punctuation">)</span>
	req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Accept"</span><span class="token punctuation">,</span> <span class="token string">"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9"</span><span class="token punctuation">)</span>
	req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Sec-Fetch-Site"</span><span class="token punctuation">,</span> <span class="token string">"same-origin"</span><span class="token punctuation">)</span>
	req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Sec-Fetch-Mode"</span><span class="token punctuation">,</span> <span class="token string">"navigate"</span><span class="token punctuation">)</span>
	req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Sec-Fetch-User"</span><span class="token punctuation">,</span> <span class="token string">"?1"</span><span class="token punctuation">)</span>
	req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Sec-Fetch-Dest"</span><span class="token punctuation">,</span> <span class="token string">"document"</span><span class="token punctuation">)</span>
	req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Referer"</span><span class="token punctuation">,</span> <span class="token string">"https://movie.douban.com/chart"</span><span class="token punctuation">)</span>
	req<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Accept-Language"</span><span class="token punctuation">,</span> <span class="token string">"zh-CN,zh;q=0.9"</span><span class="token punctuation">)</span>
	resp<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">defer</span> resp<span class="token punctuation">.</span>Body<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	docDetail<span class="token punctuation">,</span> err <span class="token operator">:=</span> goquery<span class="token punctuation">.</span><span class="token function">NewDocumentFromReader</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>Body<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	docDetail<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token string">"#content > div > div.article > ol > li > div"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Each</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>i <span class="token builtin">int</span><span class="token punctuation">,</span> s <span class="token operator">*</span>goquery<span class="token punctuation">.</span>Selection<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			<span class="token keyword">var</span> movieData MovieData
			<span class="token comment">//#content > div > div.article > ol > li:nth-child(16) > div > div.info > div.hd > a > span:nth-child(1)</span>
			title <span class="token operator">:=</span> s<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token string">"div.info > div.hd > a > span:nth-child(1)"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			img <span class="token operator">:=</span> s<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token string">"div.pic > a > img"</span><span class="token punctuation">)</span>
			imgTmp<span class="token punctuation">,</span> ok <span class="token operator">:=</span> img<span class="token punctuation">.</span><span class="token function">Attr</span><span class="token punctuation">(</span><span class="token string">"src"</span><span class="token punctuation">)</span>
			info <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token string">"div.info > div.bd > p:nth-child(1)"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">)</span>
			director<span class="token punctuation">,</span> actor<span class="token punctuation">,</span> year <span class="token operator">:=</span> <span class="token function">InfoSpite</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span>
			score <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token string">"div.info > div.bd > div > span.rating_num"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">)</span>
			score <span class="token operator">=</span> strings<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span>score<span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">)</span>
			quote <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token string">"div.info > div.bd > p.quote > span"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">)</span>
			<span class="token keyword">if</span> ok <span class="token punctuation">&#123;</span>
				movieData<span class="token punctuation">.</span>Title <span class="token operator">=</span> title
				movieData<span class="token punctuation">.</span>Director <span class="token operator">=</span> director
				movieData<span class="token punctuation">.</span>Picture <span class="token operator">=</span> imgTmp
				movieData<span class="token punctuation">.</span>Actor <span class="token operator">=</span> actor
				movieData<span class="token punctuation">.</span>Year <span class="token operator">=</span> year
				movieData<span class="token punctuation">.</span>Score <span class="token operator">=</span> score
				movieData<span class="token punctuation">.</span>Quote <span class="token operator">=</span> quote
				fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>movieData<span class="token punctuation">)</span>
				<span class="token function">InsertSql</span><span class="token punctuation">(</span>movieData<span class="token punctuation">)</span>
			<span class="token punctuation">&#125;</span>
		<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
	<span class="token comment">// if ch != nil&#123;</span>
	<span class="token comment">// 	ch &lt;- true</span>
	<span class="token comment">// &#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token function">InfoSpite</span><span class="token punctuation">(</span>info <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>director <span class="token punctuation">,</span>actor <span class="token punctuation">,</span> year <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	directorRe<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> regexp<span class="token punctuation">.</span><span class="token function">Compile</span><span class="token punctuation">(</span><span class="token string">`导演:(.*)主演:`</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>director<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">8</span> <span class="token punctuation">&#123;</span>
		director <span class="token operator">=</span> <span class="token function">string</span><span class="token punctuation">(</span>directorRe<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
		director <span class="token operator">=</span> <span class="token function">string</span><span class="token punctuation">(</span>directorRe<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
	<span class="token punctuation">&#125;</span>
	director <span class="token operator">=</span> strings<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span>director<span class="token punctuation">,</span> <span class="token string">"主演:"</span><span class="token punctuation">)</span>
	actorRe<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> regexp<span class="token punctuation">.</span><span class="token function">Compile</span><span class="token punctuation">(</span><span class="token string">`主演:(.*)`</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>actor<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">8</span> <span class="token punctuation">&#123;</span>
		actor <span class="token operator">=</span> <span class="token function">string</span><span class="token punctuation">(</span>actorRe<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
		actor <span class="token operator">=</span> <span class="token function">string</span><span class="token punctuation">(</span>actorRe<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
	<span class="token punctuation">&#125;</span>
	yearRe<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> regexp<span class="token punctuation">.</span><span class="token function">Compile</span><span class="token punctuation">(</span><span class="token string">`(\d+)`</span><span class="token punctuation">)</span>
	year <span class="token operator">=</span> <span class="token function">string</span><span class="token punctuation">(</span>yearRe<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token function">InitDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
	DB<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> sql<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">"mysql"</span><span class="token punctuation">,</span> <span class="token string">"root:20030729a@tcp(localhost:3306)/movie"</span><span class="token punctuation">)</span>
	DB<span class="token punctuation">.</span><span class="token function">SetConnMaxLifetime</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
	DB<span class="token punctuation">.</span><span class="token function">SetMaxIdleConns</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">:=</span> DB<span class="token punctuation">.</span><span class="token function">Ping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span><span class="token punctuation">&#123;</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"opon database fail"</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">&#125;</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"connnect success"</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">func</span> <span class="token function">InsertSql</span><span class="token punctuation">(</span>movieData MovieData<span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">&#123;</span>
	tx<span class="token punctuation">,</span> err <span class="token operator">:=</span> DB<span class="token punctuation">.</span><span class="token function">Begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"tx fail"</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span>
	<span class="token punctuation">&#125;</span>
	stmt<span class="token punctuation">,</span> err <span class="token operator">:=</span> tx<span class="token punctuation">.</span><span class="token function">Prepare</span><span class="token punctuation">(</span><span class="token string">"INSERT INTO movie_data (`Title`,`Director`,`Actor`,`Year`,`Score`,`Quote`) VALUES (?, ?, ?,?,?,?)"</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Prepare fail"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span>
	<span class="token punctuation">&#125;</span>
	<span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">=</span> stmt<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span>movieData<span class="token punctuation">.</span>Title<span class="token punctuation">,</span> movieData<span class="token punctuation">.</span>Director<span class="token punctuation">,</span> movieData<span class="token punctuation">.</span>Actor<span class="token punctuation">,</span> movieData<span class="token punctuation">.</span>Year<span class="token punctuation">,</span> movieData<span class="token punctuation">.</span>Score<span class="token punctuation">,</span> movieData<span class="token punctuation">.</span>Quote<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Exec fail"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span>
	<span class="token punctuation">&#125;</span>
	<span class="token boolean">_</span> <span class="token operator">=</span> tx<span class="token punctuation">.</span><span class="token function">Commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token boolean">true</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221106111317.png"></p>
</li>
<li><p>  而没有实现并发的爬虫爬取相同内容的时间达到了3s，比实现了并发的爬虫时间延长了三倍左右</p>
</li>
</ol>
<h2 id="数据分析阶段"><a href="#数据分析阶段" class="headerlink" title="数据分析阶段"></a>数据分析阶段</h2><ol>
<li>  该项目主要分析不同导演作品的数量，不同主演作品的数量和不同导演作品的得分</li>
</ol>
<h3 id="数据筛选"><a href="#数据筛选" class="headerlink" title="数据筛选"></a>数据筛选</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span>Director <span class="token keyword">from</span> movie<span class="token punctuation">.</span>movie_data <span class="token keyword">group</span> <span class="token keyword">by</span> Director<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221110111402.png"></p>
</li>
<li><p><img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221110111429.png"></p>
  <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span>Actor <span class="token keyword">from</span> movie<span class="token punctuation">.</span>movie_data <span class="token keyword">group</span> <span class="token keyword">by</span> Director<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
<h2 id="python实现mysql数据统计及可视化"><a href="#python实现mysql数据统计及可视化" class="headerlink" title="python实现mysql数据统计及可视化"></a>python实现mysql数据统计及可视化</h2><ol>
<li><p>链接数据库</p>
  <pre class="line-numbers language-python" data-language="python"><code class="language-python">db <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">3306</span><span class="token punctuation">,</span> user<span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">,</span>password<span class="token operator">=</span><span class="token string">'20030729a'</span><span class="token punctuation">,</span> database<span class="token operator">=</span><span class="token string">'movie'</span><span class="token punctuation">)</span>
cursor <span class="token operator">=</span> db<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
链接数据库 pymysql.connect的参数
connection = pymysql.connect(host='localhost',
                             user='user',
                             password='passwd',
                             database='db',
                             charset='utf8mb4',
                             cursorclass=pymysql.cursors.DictCursor)
'''</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>数据处理阶段</p>
  <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">sql</span> <span class="token operator">=</span> <span class="token string">"select count(*) cnt,Director from movie.movie_data group by Director order by cnt desc;"</span>
<span class="token keyword">cursor</span><span class="token punctuation">.</span><span class="token keyword">execute</span><span class="token punctuation">(</span><span class="token keyword">sql</span><span class="token punctuation">)</span>
res1 <span class="token operator">=</span> <span class="token keyword">cursor</span><span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>

name <span class="token operator">=</span> list<span class="token punctuation">(</span><span class="token punctuation">)</span>
cnt <span class="token operator">=</span> list<span class="token punctuation">(</span><span class="token punctuation">)</span>
count <span class="token operator">=</span> list<span class="token punctuation">(</span><span class="token punctuation">)</span>
Score <span class="token operator">=</span> list<span class="token punctuation">(</span><span class="token punctuation">)</span>
i <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">for</span> <span class="token keyword">row</span> <span class="token operator">in</span> res1:
    i <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">1</span>
    count<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    name<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token keyword">row</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    cnt<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token keyword">row</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    Score<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token keyword">row</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>画图像阶段</p>
  <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 画图像阶段</span>

plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'font.family'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'SimHei'</span>
<span class="token comment"># 建立图标</span>
fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>num<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>dpi<span class="token operator">=</span><span class="token number">45</span><span class="token punctuation">)</span>

<span class="token comment"># 设置坐标轴阶段</span>

<span class="token comment"># 设置坐标轴的范围</span>
plt<span class="token punctuation">.</span>xlim<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylim<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">70</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 隐藏无用轴</span>
ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>gca<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 将上边的坐标轴颜色设置为空，不显示</span>
ax<span class="token punctuation">.</span>spines<span class="token punctuation">[</span><span class="token string">'top'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_color<span class="token punctuation">(</span><span class="token string">'none'</span><span class="token punctuation">)</span>

<span class="token comment"># 将x轴设置为底部bottom,将y轴设置为顶部top</span>
ax<span class="token punctuation">.</span>xaxis<span class="token punctuation">.</span>set_ticks_position<span class="token punctuation">(</span><span class="token string">'bottom'</span><span class="token punctuation">)</span>
<span class="token comment"># ax.xaxis.set_ticks_position('left')</span>

<span class="token comment"># 将x轴和y轴(底轴和左轴的位置设置为坐标原点)</span>
ax<span class="token punctuation">.</span>spines<span class="token punctuation">[</span><span class="token string">'bottom'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_position<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>spines<span class="token punctuation">[</span><span class="token string">'left'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_position<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 设置坐标轴的名字</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Director'</span><span class="token punctuation">,</span>fontsize<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Number'</span><span class="token punctuation">,</span>fontsize<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>

x <span class="token operator">=</span> MultipleLocator<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>    <span class="token comment"># x轴每10一个刻度</span>
y <span class="token operator">=</span> MultipleLocator<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span>    <span class="token comment"># y轴每15一个刻度</span>

new_ticks <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span>count<span class="token punctuation">,</span>name<span class="token punctuation">,</span>rotation<span class="token operator">=</span><span class="token number">90</span><span class="token punctuation">)</span>
l1 <span class="token operator">=</span> ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>name<span class="token punctuation">,</span>cnt<span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">'blue'</span><span class="token punctuation">,</span>linewidth<span class="token operator">=</span><span class="token number">10.0</span><span class="token punctuation">,</span>linestyle<span class="token operator">=</span><span class="token string">"-"</span><span class="token punctuation">)</span>


ax2 <span class="token operator">=</span> ax<span class="token punctuation">.</span>twinx<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># ax2.xaxis.set_ticks_position('bottom')</span>
<span class="token comment"># ax2.xaxis.set_ticks_position('right')</span>
plt<span class="token punctuation">.</span>ylim<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span>
l2 <span class="token operator">=</span> ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>name<span class="token punctuation">,</span>Score<span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">,</span>linewidth<span class="token operator">=</span><span class="token number">10.0</span><span class="token punctuation">,</span>linestyle<span class="token operator">=</span><span class="token string">'--'</span><span class="token punctuation">)</span>
ax2<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">'Score'</span><span class="token punctuation">,</span>fontsize<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>

ax2<span class="token punctuation">.</span>spines<span class="token punctuation">[</span><span class="token string">'top'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_color<span class="token punctuation">(</span><span class="token string">'none'</span><span class="token punctuation">)</span>

ax<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Number'</span><span class="token punctuation">,</span><span class="token string">'Score'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>title<span class="token operator">=</span><span class="token string">'图例'</span><span class="token punctuation">,</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<h3 id="完整实现代码"><a href="#完整实现代码" class="headerlink" title="完整实现代码"></a>完整实现代码</h3><h3 id="分析Director的作品数量和整体分数之间的关系"><a href="#分析Director的作品数量和整体分数之间的关系" class="headerlink" title="分析Director的作品数量和整体分数之间的关系"></a>分析Director的作品数量和整体分数之间的关系</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pymysql
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">import</span> MultipleLocator

<span class="token comment"># 从数据库中获取数据阶段</span>
db <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">3306</span><span class="token punctuation">,</span> user<span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">,</span>password<span class="token operator">=</span><span class="token string">'20030729a'</span><span class="token punctuation">,</span> database<span class="token operator">=</span><span class="token string">'movie'</span><span class="token punctuation">)</span>
cursor <span class="token operator">=</span> db<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>
sql <span class="token operator">=</span> <span class="token string">"select count(*) cnt,Director,Score from movie.movie_data group by Director order by Score desc;"</span>

cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>
res1 <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>

name <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
cnt <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
count <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
Score <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
i <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">for</span> row <span class="token keyword">in</span> res1<span class="token punctuation">:</span>
    i <span class="token operator">+=</span> <span class="token number">1</span>
    count<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    name<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    cnt<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    Score<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 画图像阶段</span>

plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'font.family'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'SimHei'</span>
<span class="token comment"># 建立图标</span>
fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>num<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>dpi<span class="token operator">=</span><span class="token number">45</span><span class="token punctuation">)</span>

<span class="token comment"># 设置坐标轴阶段</span>

<span class="token comment"># 设置坐标轴的范围</span>
plt<span class="token punctuation">.</span>xlim<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylim<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">70</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 隐藏无用轴</span>
ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>gca<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 将上边的坐标轴颜色设置为空，不显示</span>
ax<span class="token punctuation">.</span>spines<span class="token punctuation">[</span><span class="token string">'top'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_color<span class="token punctuation">(</span><span class="token string">'none'</span><span class="token punctuation">)</span>

<span class="token comment"># 将x轴设置为底部bottom,将y轴设置为顶部top</span>
ax<span class="token punctuation">.</span>xaxis<span class="token punctuation">.</span>set_ticks_position<span class="token punctuation">(</span><span class="token string">'bottom'</span><span class="token punctuation">)</span>
<span class="token comment"># ax.xaxis.set_ticks_position('left')</span>

<span class="token comment"># 将x轴和y轴(底轴和左轴的位置设置为坐标原点)</span>
ax<span class="token punctuation">.</span>spines<span class="token punctuation">[</span><span class="token string">'bottom'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_position<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>spines<span class="token punctuation">[</span><span class="token string">'left'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_position<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 设置坐标轴的名字</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Director'</span><span class="token punctuation">,</span>fontsize<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Number'</span><span class="token punctuation">,</span>fontsize<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>

x <span class="token operator">=</span> MultipleLocator<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>    <span class="token comment"># x轴每10一个刻度</span>
y <span class="token operator">=</span> MultipleLocator<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span>    <span class="token comment"># y轴每15一个刻度</span>

new_ticks <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span>count<span class="token punctuation">,</span>name<span class="token punctuation">,</span>rotation<span class="token operator">=</span><span class="token number">90</span><span class="token punctuation">)</span>
l1 <span class="token operator">=</span> ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>name<span class="token punctuation">,</span>cnt<span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">'blue'</span><span class="token punctuation">,</span>linewidth<span class="token operator">=</span><span class="token number">10.0</span><span class="token punctuation">,</span>linestyle<span class="token operator">=</span><span class="token string">"-"</span><span class="token punctuation">)</span>


ax2 <span class="token operator">=</span> ax<span class="token punctuation">.</span>twinx<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># ax2.xaxis.set_ticks_position('bottom')</span>
<span class="token comment"># ax2.xaxis.set_ticks_position('right')</span>
plt<span class="token punctuation">.</span>ylim<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span>
l2 <span class="token operator">=</span> ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>name<span class="token punctuation">,</span>Score<span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">,</span>linewidth<span class="token operator">=</span><span class="token number">10.0</span><span class="token punctuation">,</span>linestyle<span class="token operator">=</span><span class="token string">'--'</span><span class="token punctuation">)</span>
ax2<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">'Score'</span><span class="token punctuation">,</span>fontsize<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>

ax2<span class="token punctuation">.</span>spines<span class="token punctuation">[</span><span class="token string">'top'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_color<span class="token punctuation">(</span><span class="token string">'none'</span><span class="token punctuation">)</span>

ax<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Number'</span><span class="token punctuation">,</span><span class="token string">'Score'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>title<span class="token operator">=</span><span class="token string">'图例'</span><span class="token punctuation">,</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol>
<li>  实现效果</li>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221112111608.png"></li>
</ol>
<h3 id="分析Actor作品数量和平均分数之间的关系"><a href="#分析Actor作品数量和平均分数之间的关系" class="headerlink" title="分析Actor作品数量和平均分数之间的关系"></a>分析Actor作品数量和平均分数之间的关系</h3><h3 id="实现代码"><a href="#实现代码" class="headerlink" title="实现代码"></a>实现代码</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pymysql
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">import</span> MultipleLocator


<span class="token comment"># 从数据库中获取数据阶段</span>
db <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">3306</span><span class="token punctuation">,</span> user<span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">,</span>
                     password<span class="token operator">=</span><span class="token string">'20030729a'</span><span class="token punctuation">,</span> database<span class="token operator">=</span><span class="token string">'movie'</span><span class="token punctuation">)</span>
cursor <span class="token operator">=</span> db<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>
sql <span class="token operator">=</span> <span class="token string">"select count(*) cnt,Actor,avg(Score) from movie.movie_data group by Actor order by avg(Score) desc;"</span>

cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>
res1 <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>

name <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
cnt <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
count <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
Score <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
i <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">for</span> row <span class="token keyword">in</span> res1<span class="token punctuation">:</span>
    i <span class="token operator">+=</span> <span class="token number">1</span>
    count<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    name<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    cnt<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    Score<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 画图像阶段</span>

plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'font.family'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'SimHei'</span>
<span class="token comment"># 建立图标</span>
fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>num<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dpi<span class="token operator">=</span><span class="token number">45</span><span class="token punctuation">)</span>

<span class="token comment"># 设置坐标轴阶段</span>

<span class="token comment"># 设置坐标轴的范围</span>
plt<span class="token punctuation">.</span>xlim<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylim<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 隐藏无用轴</span>
ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>gca<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 将上边的坐标轴颜色设置为空，不显示</span>
ax<span class="token punctuation">.</span>spines<span class="token punctuation">[</span><span class="token string">'top'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_color<span class="token punctuation">(</span><span class="token string">'none'</span><span class="token punctuation">)</span>

<span class="token comment"># 将x轴设置为底部bottom,将y轴设置为顶部top</span>
ax<span class="token punctuation">.</span>xaxis<span class="token punctuation">.</span>set_ticks_position<span class="token punctuation">(</span><span class="token string">'bottom'</span><span class="token punctuation">)</span>
<span class="token comment"># ax.xaxis.set_ticks_position('left')</span>

<span class="token comment"># 将x轴和y轴(底轴和左轴的位置设置为坐标原点)</span>
ax<span class="token punctuation">.</span>spines<span class="token punctuation">[</span><span class="token string">'bottom'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_position<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>spines<span class="token punctuation">[</span><span class="token string">'left'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_position<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 设置坐标轴的名字</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Actor'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Number'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>

x <span class="token operator">=</span> MultipleLocator<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>    <span class="token comment"># x轴每10一个刻度</span>
y <span class="token operator">=</span> MultipleLocator<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span>    <span class="token comment"># y轴每15一个刻度</span>

new_ticks <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span>count<span class="token punctuation">,</span> name<span class="token punctuation">,</span> rotation<span class="token operator">=</span><span class="token number">90</span><span class="token punctuation">)</span>
l1 <span class="token operator">=</span> ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>name<span class="token punctuation">,</span> cnt<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'blue'</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">10.0</span><span class="token punctuation">,</span> linestyle<span class="token operator">=</span><span class="token string">"-"</span><span class="token punctuation">)</span>


ax2 <span class="token operator">=</span> ax<span class="token punctuation">.</span>twinx<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># ax2.xaxis.set_ticks_position('bottom')</span>
<span class="token comment"># ax2.xaxis.set_ticks_position('right')</span>
plt<span class="token punctuation">.</span>ylim<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span>
l2 <span class="token operator">=</span> ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>name<span class="token punctuation">,</span> Score<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">10.0</span><span class="token punctuation">,</span> linestyle<span class="token operator">=</span><span class="token string">'--'</span><span class="token punctuation">)</span>
ax2<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">'Score'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>

ax2<span class="token punctuation">.</span>spines<span class="token punctuation">[</span><span class="token string">'top'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_color<span class="token punctuation">(</span><span class="token string">'none'</span><span class="token punctuation">)</span>

ax<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Number'</span><span class="token punctuation">,</span> <span class="token string">'Score'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> title<span class="token operator">=</span><span class="token string">'图例'</span><span class="token punctuation">,</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<ol>
<li>  分析年份和评分之间的关系的完整实现代码</li>
</ol>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pymysql
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">import</span> MultipleLocator


<span class="token comment"># 从数据库中获取数据阶段</span>
db <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">3306</span><span class="token punctuation">,</span> user<span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">,</span>
                     password<span class="token operator">=</span><span class="token string">'20030729a'</span><span class="token punctuation">,</span> database<span class="token operator">=</span><span class="token string">'movie'</span><span class="token punctuation">)</span>
cursor <span class="token operator">=</span> db<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>
sql <span class="token operator">=</span> <span class="token string">"select count(*) cnt,Year,avg(Score) from movie.movie_data group by Year order by Year;"</span>

cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>
res1 <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>

name <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
cnt <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
count <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
xu <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
Score <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
i <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">for</span> row <span class="token keyword">in</span> res1<span class="token punctuation">:</span>
    i <span class="token operator">+=</span> <span class="token number">1</span>
    count<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    name<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    cnt<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    Score<span class="token punctuation">.</span>append<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 画图像阶段</span>

plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'font.family'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'SimHei'</span>
<span class="token comment"># 建立图标</span>
fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>num<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dpi<span class="token operator">=</span><span class="token number">45</span><span class="token punctuation">)</span>

<span class="token comment"># 设置坐标轴阶段</span>

<span class="token comment"># 设置坐标轴的范围</span>
plt<span class="token punctuation">.</span>xlim<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylim<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 隐藏无用轴</span>
ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>gca<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 将上边的坐标轴颜色设置为空，不显示</span>
ax<span class="token punctuation">.</span>spines<span class="token punctuation">[</span><span class="token string">'top'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_color<span class="token punctuation">(</span><span class="token string">'none'</span><span class="token punctuation">)</span>

<span class="token comment"># 将x轴设置为底部bottom,将y轴设置为顶部top</span>
ax<span class="token punctuation">.</span>xaxis<span class="token punctuation">.</span>set_ticks_position<span class="token punctuation">(</span><span class="token string">'bottom'</span><span class="token punctuation">)</span>
<span class="token comment"># ax.xaxis.set_ticks_position('left')</span>

<span class="token comment"># 将x轴和y轴(底轴和左轴的位置设置为坐标原点)</span>
ax<span class="token punctuation">.</span>spines<span class="token punctuation">[</span><span class="token string">'bottom'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_position<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>spines<span class="token punctuation">[</span><span class="token string">'left'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_position<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 设置坐标轴的名字</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Year'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Score'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>

x <span class="token operator">=</span> MultipleLocator<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>    <span class="token comment"># x轴每10一个刻度</span>
y <span class="token operator">=</span> MultipleLocator<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token comment"># y轴每15一个刻度</span>

new_ticks <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span>count<span class="token punctuation">,</span> name<span class="token punctuation">,</span> rotation<span class="token operator">=</span><span class="token number">90</span><span class="token punctuation">)</span>
l1 <span class="token operator">=</span> ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>name<span class="token punctuation">,</span>Score<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'blue'</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">10.0</span><span class="token punctuation">,</span> linestyle<span class="token operator">=</span><span class="token string">"-"</span><span class="token punctuation">)</span>

x <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">,</span><span class="token number">256</span><span class="token punctuation">,</span>endpoint<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
y <span class="token operator">=</span> x<span class="token operator">*</span><span class="token number">0.0112</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">9.3</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">,</span>linewidth<span class="token operator">=</span><span class="token string">'10'</span><span class="token punctuation">,</span>linestyle<span class="token operator">=</span><span class="token string">'--'</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="根据上述图表进行数据分析"><a href="#根据上述图表进行数据分析" class="headerlink" title="根据上述图表进行数据分析"></a>根据上述图表进行数据分析</h2><p><img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221128213448.png"></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/%E5%85%83%E6%95%B0%E6%8D%AE%E5%BA%93(mysql)%E5%AE%89%E8%A3%85/">
                linux环境下元数据库(mysql)的安装
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2022-11-02</span>
            
            
                <a href="http://dezhoutorizhao.github.io/%E5%85%83%E6%95%B0%E6%8D%AE%E5%BA%93(mysql)%E5%AE%89%E8%A3%85/#disqus_thread" class="comments article-comment-link">留言</a>
            
            
                <span class="category">
                    <a href="/categories/mysql/">mysql</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <h1 id="linux环境下元数据库-mysql-的安装"><a href="#linux环境下元数据库-mysql-的安装" class="headerlink" title="linux环境下元数据库(mysql)的安装"></a>linux环境下元数据库(mysql)的安装</h1><h2 id="解压mysql安装包"><a href="#解压mysql安装包" class="headerlink" title="解压mysql安装包"></a>解压mysql安装包</h2><ol>
<li>  将mysql的安装文件移至/root/downloads下</li>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221102102905.png"></li>
<li>  创建文件夹/root/bigdata/mysql</li>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221102102921.png"></li>
<li>  将安装文件解压至/root/bigdata/mysql</li>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221102102932.png"></li>
<li>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221102102951.png"></li>
</ol>
<h2 id="升级并安装依赖包"><a href="#升级并安装依赖包" class="headerlink" title="升级并安装依赖包"></a>升级并安装依赖包</h2><ol>
<li><p>```<br>  root@master:~/bigdata/mysql# sudo apt-get upgrade</p>
  <pre class="line-numbers language-none"><code class="language-none">
### 如果报错

1.   &#96;&#96;&#96;
     E: 无法获得锁 &#x2F;var&#x2F;lib&#x2F;dpkg&#x2F;lock-frontend - open (11: 资源暂时不可用)
     E: 无法获取 dpkg 前端锁 (&#x2F;var&#x2F;lib&#x2F;dpkg&#x2F;lock-frontend)，是否有其他进程正占用它？
     root@master:~&#x2F;bigdata&#x2F;mysql# rm &#x2F;var&#x2F;cache&#x2F;apt&#x2F;archives&#x2F;lock
     root@master:~&#x2F;bigdata&#x2F;mysql# rm &#x2F;var&#x2F;lib&#x2F;dpkg&#x2F;lock
     root@master:~&#x2F;bigdata&#x2F;mysql# rm &#x2F;var&#x2F;lib&#x2F;dpkg&#x2F;lock-frontend
     root@master:~&#x2F;bigdata&#x2F;mysql# apt-get upgrade
     E: dpkg 被中断，您必须手工运行 ‘dpkg --configure -a’ 解决此问题。
     root@master:~&#x2F;bigdata&#x2F;mysql# rm &#x2F;var&#x2F;lib&#x2F;dpkg&#x2F;updates&#x2F;*
     root@master:~&#x2F;bigdata&#x2F;mysql# apt-get update<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221102103045.png"></p>
</li>
<li><p>```<br>  root@master:~/bigdata/mysql# apt-get upgrade</p>
  <pre class="line-numbers language-none"><code class="language-none">
4.   ![](https:&#x2F;&#x2F;strongwillpro.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;20221102103104.png)

5.   ![](https:&#x2F;&#x2F;strongwillpro.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;20221102103122.png)

6.    

     [无法获取 dpkg 前端锁 (&#x2F;var&#x2F;lib&#x2F;dpkg&#x2F;lock-frontend)，是否有其他进程正占用它？ - while19 - 博客园 (cnblogs.com)](https:&#x2F;&#x2F;www.cnblogs.com&#x2F;while19&#x2F;p&#x2F;16197099.html)

     [(23条消息) dpkg 被中断问题解决方法_半遮雨的博客-CSDN博客_dpkg中断](https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_14935437&#x2F;article&#x2F;details&#x2F;77199615)

7.   &#96;&#96;&#96;
     root@master:~&#x2F;bigdata&#x2F;mysql# apt-get install libaio1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221102103147.png"></p>
</li>
</ol>
<h3 id="3-按顺序安装deb-程序包"><a href="#3-按顺序安装deb-程序包" class="headerlink" title="3.按顺序安装deb*****程序包*"></a>3.按顺序安装deb****<em><strong>*程序包*</strong></em></h3><ol>
<li><p>```bash<br>  root@master:~/bigdata/mysql# dpkg -i mysql-common_8.0.14-1ubuntu18.04_amd64.deb</p>
  <pre class="line-numbers language-none"><code class="language-none">
2.   ![](https:&#x2F;&#x2F;strongwillpro.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;20221102103226.png)

3.   &#96;&#96;&#96;
     root@master:~&#x2F;bigdata&#x2F;mysql# dpkg -i libmysqlclient21_8.0.14-1ubuntu18.04_amd64.deb<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221102103239.png"></p>
</li>
<li><p>```<br>  root@master:~/bigdata/mysql# dpkg -i libmysqlclient-dev_8.0.14-1ubuntu18.04_amd64.deb</p>
  <pre class="line-numbers language-none"><code class="language-none">
6.   ![](https:&#x2F;&#x2F;strongwillpro.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;20221102103254.png)

7.   &#96;&#96;&#96;bash
     root@master:~&#x2F;bigdata&#x2F;mysql# dpkg -i mysql-community-client-core_8.0.14-1ubuntu18.04_amd64.deb<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221102103310.png"></p>
</li>
<li><p>```bash<br>  root@master:~/bigdata/mysql# dpkg -i mysql-community-client_8.0.14-1ubuntu18.04_amd64.deb</p>
  <pre class="line-numbers language-none"><code class="language-none">
10.   ![](https:&#x2F;&#x2F;strongwillpro.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;20221102103324.png)

11.   &#96;&#96;&#96;bash
      root@master:~&#x2F;bigdata&#x2F;mysql# apt-get install libaio1 libmecab2 openssh-client<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>  <img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/20221102103347.png"></p>
</li>
<li><p>```bash<br>  root@master:~/bigdata/mysql# dpkg -i mysql-community-server-core_8.0.14-1ubuntu18.04_amd64.deb</p>
  <pre class="line-numbers language-none"><code class="language-none">
14.   ![](https:&#x2F;&#x2F;strongwillpro.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;20221102103406.png)

15.   &#96;&#96;&#96;bash
      root@master:~&#x2F;bigdata&#x2F;mysql# dpkg -i mysql-community-server_8.0.14-1ubuntu18.04_amd64.deb<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>  此过程会出现图形化界面设置MySQL的密码及验证方式等。</p>
</li>
<li><p>```bash<br>  root@master:~/bigdata/mysql# dpkg -i mysql-server_8.0.14-1ubuntu18.04_amd64.deb</p>
  <pre class="line-numbers language-none"><code class="language-none">
18.   ![](https:&#x2F;&#x2F;strongwillpro.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;20221102103440.png)

## ***\*4.\**** ***\*检验M\***\*ySQL\*******\*是否安装成功\****

1.   ![](https:&#x2F;&#x2F;strongwillpro.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;20221102103503.png)

## ***\*5.\**** ***\*M\*******\*ySQL\*******\*数据库操作\****

&#96;&#96;&#96;bash
（1）登录
mysql -u root –p
（2）创建新用户
create user &#39;hadming&#39;@&#39;%&#39; identified by &#39;123456&#39;;
（3）为用户授权
mysql&gt; grant all on *.* to &#39;hadming&#39;@&#39;%&#39;;
（4）创建数据库
create database hadoopDB;
（5）查看数据库
show databases;
(6)选择数据库
Use hadoopDB
(7)删除数据库
（8）创建表<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>

        </div>
    

</div>
            
        </section>
    </div>
</div>



    <div class="row">
        <div class="col-sm-12">
            <div class="wrap-pagination">
                <a class="" href="/">
                    <i class="fa fa-chevron-left" aria-hidden="true"></i>
                </a>
                <a class="" href="/page/3/">
                    <i class="fa fa-chevron-right" aria-hidden="true"></i>
                </a>
            </div>
        </div>
    </div>




</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 footer-about">
                <h2>About</h2>
                <p>
                    拒绝划水，拒绝摸鱼
                </p>
            </div>
            
    <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 recent-posts">
        <h2>Recent Posts</h2>
        <ul>
            
            <li>
                <a class="footer-post" href="/2023%E5%A4%8D%E7%9B%98/">2023复盘</a>
            </li>
            
            <li>
                <a class="footer-post" href="/%E4%BE%A7%E4%BF%A1%E9%81%93%E6%94%BB%E5%87%BB/">侧信道攻击</a>
            </li>
            
            <li>
                <a class="footer-post" href="/%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%8D%8A%E5%86%B3%E8%B5%9B_%E7%94%B5%E5%AD%90%E5%8F%96%E8%AF%81/">蓝帽杯半决赛wp_电子取证部分</a>
            </li>
            
            <li>
                <a class="footer-post" href="/%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%8D%8A%E5%86%B3%E8%B5%9B_web/">蓝帽杯半决赛wp_web部分</a>
            </li>
            
        </ul>
    </div>



            
<div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 footer-categories">
    <h2>Categories</h2>
    <ul>
        
        <li>
            <a class="footer-post" href="/categories/CSS/">CSS</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/CSS/ing/">ing</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/Hadoop/">Hadoop</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/ing/">ing</a>
        </li>
        
    </ul>
</div>

        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://github.com/dezhoutorizhao/blog6">
                            <span class="footer-icon-container">
                                <i class="fa fa-github"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://github.com/dezhoutorizhao/blog6">
                            <span class="footer-icon-container">
                                <i class="fa fa-twitter"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://github.com/dezhoutorizhao/blog6">
                            <span class="footer-icon-container">
                                <i class="fa fa-facebook"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://github.com/dezhoutorizhao/blog6">
                            <span class="footer-icon-container">
                                <i class="fa fa-instagram"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://github.com/dezhoutorizhao/blog6">
                            <span class="footer-icon-container">
                                <i class="fa fa-dribbble"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="http://dezhoutorizhao.github.io/blog6/">
                            <span class="footer-icon-container">
                                <i class="fa fa-telegram"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="http://dezhoutorizhao.github.io/blog6/">
                            <span class="footer-icon-container">
                                <i class="fa fa-behance"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="http://dezhoutorizhao.github.io/blog6/">
                            <span class="footer-icon-container">
                                <i class="fa fa-500px"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="mailto:a18888200398@163.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-envelope-o"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="\#">
                            <span class="footer-icon-container">
                                <i class="fa fa-rss"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                    @Untitled. All right reserved | Design & Hexo <a target="_blank" rel="noopener" href="http://www.codeblocq.com/">Jonathan Klughertz</a>
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- After footer scripts -->

<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JavaScript -->

<script src="/js/main.js"></script>


<!-- Disqus Comments -->

<script type="text/javascript">
    var disqus_shortname = 'klugjotest';

    (function(){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



</body>

</html>